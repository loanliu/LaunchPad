    // PersonalizeHome.html - used in LaunchPad Personalize home page
    /*--------------------------CHANGE LOGS --------------------------------------
        9/27/2022 - removed voice, sfdc, playbook linke updated discoverdaily link
        6/30/22 - change Unboxd Indirect to Indirect Sales Tools and point it to vzdaily
        3/2/22 - change sort order to priority then project name
        1/05/22 - add FWA PMO
        11/1/21 - fix saturday
        10/24/21 - B2B is now on Thursday, daysArray[4], not daysArray[5]
        10/04/21 - change date range from Sunday to Saturday
        08/10/21 - remove "Promos ending" for "everyone"
        08/09/21 - open Happeninging container for "everyone", restrict access to 3 day rolling
        08/03/21 - add field leadership Q&A
        07/21/21 - change TMP request to https://learnprod-tpm.verizon.com/tpmx/#/tpm/allRequests
        04/09/21 - spit stackability into In-Market and Historical Stackability
        03/31/2021 - make sure Launch Date is today or in the future
        03/16/21 - change from -4 to -5 to match DD
        02/23/21 - remove "Else" when checking calendarLevel == 1
        02/19/21 - remove Unbox Retail link for DD
        02/01/21 - open up Field Meeting for Profile_Calendar_user
        01/08/21 - change IMC LM Calendar (Local Marketing) instead of Field Activation
         01/07/21 - no longer need to send dates to archive
        12.15.20 - remove CRM
        10.15.20 - swap out retropective link as per Mila request
        09.23.20 - display non PROMO parent record as per Jen's request
        09.17.20 - fix director profile - don't show interlock and b2b interlock
        09.03.20 - clean up calendar links (startYourDay)
        08.21.20 - open up My project/Submit Brief for everyone
        08.14.20 - Move calendar group above field and GM views
        07.10.20 - add unapproved Promo
        06.22.20 - change lastDay for GTM users to 60 days, not 14
        06.16.20 - open up "submit Brief" to everyone
        06.13.20 - remove Training_x0020_Launch_x0020_Date (Q2 changes)
        05.16.2020 - use Promo End Date Modified Date to limit extended promos
        04.16.20 - redesign 2020
        03.31.20   - change 7 days to 3 days (#729)
        03.26.20  - remove Meeting_x0020_Type
        03.10.20 - add &$ to select  - this will aleviate issues with too many "multiple person" columns
        03.02.20  - replace ConfigNotes of Meeting Agendas with Appendix_x003F_  (Appendix?)
        02.26.20   - include any promotion extension regardless of launch date (promo end date ranges: today till today+120
        02.21.20 - correct query to include TBD briefs (can't query by null date, must query by launch date modified date
        02.11.20  - Remove base64 - it does nothing, yet clutters the codes
        01.21.20 -  look for non space managing channel
        01.13.20   - #686 - remove parent projects from view
        01.13.20 - #685 remove Training and Merchandising
        11.15.19 - get user name directly from this module
        11.04.19  - add compareDates(launchDate,today,lastDay) to newview - need to check with Lisa first - HOLD FOR NOW
        10.09.19  -  support promotion extension, add stackability to Helpful Links
        10.03.19 - change My View to My Projects/Briefs
        10.03.19   -  add SFDC and Voice to Helpful Links for Field and GM
        02.15.19 - initial version
        06.10.19 - remove CSS Meeting/material/archive
                 - open up Archive to everyone
        06.14.19 - fix erroneous display of training materials (mixed up in regular launches)
        07.10.19 - GTM will override all other roles - also sort meeting agendas by ConfigNotes (Appendix)
        07.11.19 - correct how TBD is displayed and retrieved in what's new, what's changed
        07.12.19 - display non dark Field Meeting only (for DM)
        07.15.19 - hide "Dark" for all agenda meetings, not just Field Meeting
        07.17.19 - split CCRS into Retail and Indirect
        08.01.19 - change getHappenings logic to NOT use SPService
        08.19.19 - change compare7Days to -7, not -8
        08.21.19 - fix "day" portion of this week/next week if it does not have any meetings - hard code daysArray[]
        08.26.19  -  change moment.utc and format date correctly
        09.03.19  -  add resource central for DM (under helpful Links)
      ---------------------------------------------------------------------------*/
      
    var userRoles = [];
    var securityLevel = 0;
    var calendarLevel = 0;
    var cssEvents = [];
    var executiveEvents = [];
    var interlockEvents = [];
    var leadershipEvents = [];
    var calendarEvents = [];
    var trainingEvents = [];
    var merchandisingEvents = [];
    var b2bInterlockEvents = [];
    var today = new Date();
    var monday = new Date();
    var wednesday = new Date();
    var thursday = new Date();
    var friday = new Date();
    var saturday = new Date();
    var sunday = new Date();
    var nextmonday = new Date();
    var nextwednesday = new Date();
    var nextthursday = new Date();
    var nextfriday = new Date();
    var nextsaturday = new Date();
    var nextsunday = new Date();
    var lastDay, GMLastDay, DMLastDay;
    var curSource = new Array();
    var currentURL = _spPageContextInfo.serverRequestPath;
    var cssPresenter="", executivePresenter="", interlockPresenter="", leadershipPresenter="";
    var darkIndicator, rrgentDate, urgentMessage1, urgentMessage2, specialMessage, specialMeetingDate;
    var launchArray = [];
    var promoArrayWaag = [];
    var promoArray = [];
    var trainingArray = [];
    var merchandisingArray = [];
    var thisweekArray = [];
    var nextweekArray = [];
    var daysArray = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    var monthsArray = ['January','February','March','April','May','June','July','August', 'September','October','November','December'];
    var daysinweek = [];
    var day;
    var ua;
    var msie; 
    var isCRM = false;
    var isPNB = false;
    var isNE = false;
    var isSE = false;
    var isNC = false;
    var isSC = false;
    var isGL = false;
    var isPC = false;
    var isIMCHQ = false;
    var isIMCFA = false;
    var isBranding = false;
    var isPMO = false;
    var isFWAPMO = false;
    var isPromo = false;
    var isDM = false;
    var isSalesOps = false;
    var isIMCAdmin = false, isSalesOpsAdmin = false, isUnapprovedPromoAdmin = false;
    var isUnapprovedPromo = false;
    var isNBx = false;
    var isLocal = false;
    // 02/19/21 - remove Unboxd Retail - added back as per Lisa's request:  <a href='https://unboxd.multiscreensite.com' target='_blank'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retail &gt;</a>

    var isGTM, isInterlock, isVPandDirector, isFieldDM, isCalendar, isEveryone=true, isGM, isSalesOps, isSalesOpsGMSM, isSalesOpsExec;
    var isCGTM = false;
    
    var executiveMeetingCheck = [];
    var marketingMeetingCheck = [];
    var fieldMeetingCheck = [];
    
    var endingSoonCount = 0;
    var newCount = 0;
    var changeCount = 0;
    var extendedCount = 0;

    //executiveMeetingCheck[7]="";
    //marketingMeetingCheck[7]="";
    //fieldMeetingCheck[7]="";

    $(document).ready(function(){
        sessionStorage.setItem("editURL", currentURL);
        decodeImages();
        lastDay = addDays(today, 60); // changed on 6/22/20
        GMLastDay  = addDays(today, 7);
        DMLastDay  = addDays(today, 14);
        //setArchiveURL();	// 01/07/2021 - no longer need to send dates to archive
        // change target to blank just in case user clicks on Training, merchandising links
        $(document).on('click', 'a',function(){
            //if ($(this)[0].href.indexOf("OpenPopUp") == -1 && $(this)[0].href.indexOf("GTM%20Thank%20You") == -1)
                   //$(this).attr("target","_blank");
        }); 
    
        ua = window.navigator.userAgent;
        msie = ua.indexOf("MSIE "); 
        var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        //if (w > 1280)
        //$("#contentBox").css({"border": "1px solid silver"});
    
        $("div[id^='MSOZoneCell_WebPartctl00_ctl27']").css({"width": "300px"});
        //$("#startyourday")[0].innerHTML = startYourDay;
        if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
        {
               //$(".launchbox").css({"margin": "3px"});
        }
        else
            $("#MSOZoneCell_WebPartctl00_ctl27_g_25145aad_ae9e_4f33_9d2e_7a70b17808fc").css({"width": "300px"});
            
        //var names = sessionStorage.getItem("loginName");
        var names = localStorage.getItem("loginName");
        if (names == null || typeof names == 'undefined')
        {
            names = [];
            names[0] = "";
            ExecuteOrDelayUntilScriptLoaded(updateUserProfilePreFlight, "sp.js");
            GetCurrentUsername();
        }
        else
            names = names.split(",");
        // select only the first section of name, for example, Lisa K. will just be Lisa	
        if (names.length > 1)
        {	
            names = names[1].trim().split(" ");
            $("#firstname")[0].innerHTML = names[0] + ",";
        }
        else
            $("#firstname")[0].innerHTML = names[0] + ",";
    
        //10/04/21 - day is now Sunday
        //day = sunday.getDay() || 7;;
        //if( day !== 0 )
        //{                // Only manipulate the date if it isn't Mon.
            sunday.setHours(-48 * (day - 1));   // Set the hours to day number minus 1
        //}
        var curr = new Date; // get current date
        var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
        var last = first + 6; // last day is the first day + 6
        
        sunday = new Date(curr.setDate(first));//.toUTCString();
        //saturday = new Date(curr.setDate(last));//.toUTCString();	
        var days = 4;
        wednesday = addDays(sunday, 3);
        thursday = addDays(sunday, 4);
        friday = addDays(sunday, 5);
        saturday = addDays(sunday, 6);
        nextwednesday = addDays(wednesday, 7);
        nextthursday = addDays(thursday, 7);
        nextfriday = addDays(friday, 7);
        //saturday = 	addDays(sunday, 5);
        monday = addDays(sunday, 1);
        nextmonday = addDays(monday, 7);	
        nextsaturday = addDays(saturday, 7);
        nextsunday = addDays(sunday, 7);
        
        day = today.getDay(); // Get current day number, converting Sun. to 7 - Do not convert Sunday to 7  || 7

        //daysinweek.push(sunday);    
        //daysinweek.push(monday);
        //daysinweek.push(addDays(monday, 1));
        //daysinweek.push(addDays(monday, 2));
        //daysinweek.push(addDays(monday, 3));
        //daysinweek.push(addDays(monday, 4));
        //daysinweek.push(addDays(monday, 5));
        //daysinweek.push(day);
        
        monday.setHours(0,0,0,0);
        sunday.setHours(0,0,0,0);
        saturday.setHours(0,0,0,0);	
        nextsunday.setHours(0,0,0,0);

        today.setHours(0,0,0,0);
        daysinweek.push(addDays(today,1));
        daysinweek.push(addDays(today,2));
        daysinweek.push(addDays(today,3));
        daysinweek.push(addDays(today,4));
        daysinweek.push(addDays(today,5));
        daysinweek.push(addDays(today,6));
        daysinweek.push(addDays(today,7));
        daysinweek.push(day);

       
        // no longer needed for Redesign 2020
        //$("#changedview")[0].innerHTML = "'<div class='contentheaderbold' style='margin-top:5px'>Promotion Extensions</div><div id='promoextended' class='contentheader'></div><div class='contentheaderbold' style='margin-top:5px'>Launch Date Changes</div><div id='launchdatechanges' class='contentheader'></div>";
        
        for (i=0;i<5;i++)
        {
            thisweekArray.push ([]);
            nextweekArray.push([]);
        }
        //checkCalendarViewComplete();
        
        for (i=0;i<8;i++)
        {
        
            launchArray.push ([]);
            promoArray.push([]);
            promoArrayWaag.push([]);
            //trainingArray.push([]);
            //merchandisingArray.push([]);
            //$("#dayheader" + i)[0].innerHTML = "<span class='sectionfont'>" + daysArray[i] + " " + reformatDate((daysinweek[i])) + "</span>";
            if (isEveryone){
                if(i<7)
                    $("#day" + i)[0].innerHTML= "<div class='row waag-container'><div class='date-section column left'><span class='date-container'>" + reformatDateHtml((daysinweek[i])) + "<span class='day-week date-font'>" + daysArray[daysinweek[i].getDay()] + "</span></span></div>" + "<div class='day-card column right'><div class='row'><div class='column'><div class='launches-column launches-title'>Promotions</div><div style='margin-bottom:15px' id='promowaag" + i + "'></div></div><hr class='daycard'><div class='column'><div class='launches-column launches-title'>Launches</div><div style='margin-bottom:15px' id='launch" + i + "'></div></div><hr class='daycard'><div class='column'><div class='meetings-column launches-title'>Meetings</div><div class='no-new-font'>No Meetings</div><div></div></div></div></div></div>";	
                else
                    $("#day" + i)[0].innerHTML= "<div class='row waag-container'><div class='date-section column left'><span class='date-container'>" + reformatDateHtml(today) + "<span class='day-week date-font'>" + daysArray[day] + "</span></span></div>" + "<div class='day-card column right'><div class='row'><div class='column'><div class='launches-column launches-title'>Promotions</div><div style='margin-bottom:15px' id='promowaag" + i + "'></div></div><hr class='daycard'><div class='column'><div class='launches-column launches-title'>Launches</div><div style='margin-bottom:15px' id='launch" + i + "'></div></div><hr class='daycard'><div class='column'><div class='meetings-column launches-title'>Meetings</div><div class='no-new-font'>No Meetings</div><div></div></div></div></div></div>";	

            } else {
                if(i<7){
                        $("#day" + i)[0].innerHTML = "<div class='row waag-container'><div class='date-section column left'><span class='date-container'>" + reformatDateHtml((daysinweek[i])) + "<span class='day-week date-font'>" + daysArray[daysinweek[i].getDay()] + "</span></span></div>" + "<div class='day-card column right'><div class='row'><div class='column'><div class='launches-column launches-title'>Promotions</div><div style='margin-bottom:15px' id='promowaag" + i + "'></div></div><hr class='daycard'><div class='column'><div class='launches-column launches-title'>Launches</div><div style='margin-bottom:15px' id='launch" + i + "'></div></div><hr class='daycard'><div class='column'><div class='meetings-column launches-title'>Meetings</div><div id='meeting" + i + "'>No Meetings</div><div></div></div></div></div></div>";	
                }else {
                        $("#day" + i)[0].innerHTML = "<div class='row waag-container'><div class='date-section column left'><span class='date-container'>" + reformatDateHtml(today) + "<span class='day-week date-font'>" + daysArray[day] + "</span></span></div>" + "<div class='day-card column right'><div class='row'><div class='column'><div class='launches-column launches-title'>Promotions</div><div style='margin-bottom:15px' id='promowaag" + i + "'></div></div><hr class='daycard'><div class='column'><div class='launches-column launches-title'>Launches</div><div style='margin-bottom:15px' id='launch" + i + "'></div></div><hr class='daycard'><div class='column'><div class='meetings-column launches-title'>Meetings</div><div id='meeting" + i + "'></div><div></div></div></div></div></div>";	
                }
            }
            
        }
        

    getGTMMessage();
    getHappenings();
    getMeetingAgendas();	
    setCalendarItems();
    setEndingSoonItems();
        
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the dimmer 
    var dimmer = document.getElementById("myDimmer");

    if(extendedCount > 4){
        // Get the button that opens the extended modal
        var btnExtended = document.getElementById("extendedLink");

        // When the user clicks on the button, open the modal
        btnExtended.onclick = function() {
        modal.style.display = "block";
        dimmer.style.display = "block";
        endingSoon.style.display = "none";
        rescheduled.style.display = "none";
        extended.style.display = "contents";
        newlyAdded.style.display = "none";
        }
    }   

    if(changeCount > 4){

        // Get the button that opens the reschedule modal
        var btnRescheduled = document.getElementById("rescheduledLink");

        // When the user clicks on the button, open the modal
        btnRescheduled.onclick = function() {
        modal.style.display = "block";
        dimmer.style.display = "block";
        endingSoon.style.display = "none";
        rescheduled.style.display = "contents";
        extended.style.display = "none";
        newlyAdded.style.display = "none";
        }
    }

    if(newCount > 4){
        // Get the button that opens the reschedule modal
        var btnNew = document.getElementById("newLink");

        // When the user clicks on the button, open the modal
        btnNew.onclick = function() {
        modal.style.display = "block";
        dimmer.style.display = "block";
        endingSoon.style.display = "none";
        rescheduled.style.display = "none";
        extended.style.display = "none";
        newlyAdded.style.display = "contents";
        }
    }

    if(endingSoonCount > 4){
        
        // Get the button that opens the ending soon modal
        var btn = document.getElementById("modal-link");
        
        // When the user clicks on the button, open the modal
        btn.onclick = function() {
            modal.style.display = "block";
            dimmer.style.display = "block";
            endingSoon.style.display = "contents";
            extended.style.display = "none";
            rescheduled.style.display = "none";
            newlyAdded.style.display = "none";
        }
    }

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    var endingSoon = document.getElementById("endingSoonModal");
    var extended = document.getElementById("extendedModal");
    var rescheduled = document.getElementById("rescheduledModal");
    var newlyAdded = document.getElementById("newModal");

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
    modal.style.display = "none";
    dimmer.style.display = "none";
    endingSoon.style.display = "none";
    rescheduled.style.display = "none";
    extended.style.display = "none";
    newlyAdded.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
            dimmer.style.display = "none";
            endingSoon.style.display = "none";
            rescheduled.style.display = "none";
            extended.style.display = "none";
            newlyAdded.style.display = "none";
        }

        if (!event.target.matches('.dropdown-button')) {
            var dropdowns = document.getElementById("consumerroadmapwaag");
            console.log(dropdowns.classList);
            if(dropdowns != null && dropdowns.classList.contains('display-dropdown'))
                $("#consumerroadmapwaag").removeClass("display-dropdown");
        }
    }

    /*
        //var view = $("#launchslides");
        var move = "300px";
        var sliderLimit = -1500;//-1200;
        var leftLimit = 0;
        var duration = 300;
        var firstLeftMove = false;
        //$("#rightArrow").trigger("click"); // move pass Sunday to display Monday as default
        //day = 3; // for testing only
        if (day < 3)
        {
            var currentPosition = parseInt(view.css("left"));
            if (currentPosition >= sliderLimit) view.stop(false,true).animate({left:"-="+move},{ duration: 300});
            sliderLimit = -600;//-900;
         }
        else // if (day == 4)
        {
            sliderLimit = -1500;//-1200;
            var move = "908px";  // this control how far right you'd move
            leftLimit = -2;
            var currentPosition = parseInt(view.css("left"));
            if (currentPosition >= sliderLimit) view.stop(false,true).animate({left:"-="+move},{ duration: 300});
        }
        */
        /*else
        {
            //sliderLimit = -1200;
            var move = "930px";
            //var move = "1220px";  // this control how far right you'd move
            var currentPosition = parseInt(view.css("left"));
            if (currentPosition >= sliderLimit) view.stop(false,true).animate({left:"-="+move},{ duration: 300});
        }*/
    /*   
        //move = "300px";
        //sliderLimit = -1600;
        $("#rightArrow").click(function(){
            move = "300px";
            var currentPosition = parseInt(view.css("left"));
             console.log ("right currentPosition:" + currentPosition);
             //if (currentPosition < -910)
            if (currentPosition < -899)		 
                 move = "0px";
            if (currentPosition >= sliderLimit) view.stop(false,true).animate({left:"-="+move},{ duration: 300});
        
        });	
        $("#leftArrow").click(function(){
        // pause the code a little bit if the user clicks too fast
        
            //var move = "300px";
            if (!firstLeftMove && day > 2)
            {
                move = "308px";
                firstLeftMove = true;
                duration = 308;
            }
            else
            {
                move = "300px";
                duration = 300;
            }
            /*setTimeout(function(){
                a=1;
                
            },10000); 	*/
            /*
            var currentPosition = parseInt(view.css("left"));
            // stop scrooling if we're at -2, which is Sunday (903 as we start the day)
            console.log ("left currentPosition:" + currentPosition);
                
            if (currentPosition > -300)
            {
                move = "0px";
                     console.log ("left currentPosition AFTER adjustment:" + currentPosition);	    
                }
            if (currentPosition < leftLimit) view.stop(false,true).animate({left:"+="+move},{ duration: duration});
        
        });	
        var thisweekview = $("#thisweekslides");
        var nextweekview = $("#nextweekslides");
        var materialview = $("#materialslides");
        var archiveview = $("#archiveslides");
        $("#rightArrow2").click(function(){
            
            var currentPosition = parseInt(thisweekview.css("left"));
            //var sliderLimit = -401;
            var sliderLimit = -100;
            move = "300px";
            if (currentPosition >= sliderLimit)
            {
                thisweekview.stop(false,true).animate({left:"-="+move},{ duration: 300});
                nextweekview.stop(false,true).animate({left:"-="+move},{ duration: 300});
                materialview.stop(false,true).animate({left:"-="+move},{ duration: 300});
                archiveview.stop(false,true).animate({left:"-="+move},{ duration: 300});
            }
        });	
        $("#leftArrow2").click(function(){
        
            var currentPosition = parseInt(thisweekview.css("left"));
            var sliderLimit = -300;
            move = "300px";
            if (currentPosition < 0) 
            {
                thisweekview.stop(false,true).animate({left:"+="+move},{ duration: 300});
                nextweekview.stop(false,true).animate({left:"+="+move},{ duration: 300});
                materialview.stop(false,true).animate({left:"+="+move},{ duration: 300});
                archiveview.stop(false,true).animate({left:"+="+move},{ duration: 300});
            }
        });	
    */
    }); // end of document ready
    
    function openTabs(event, tabName){

        if(tabName == 'Today'){
            $("#today-tab").removeClass('grey-tab-font').addClass('black-tab-font');
            $("#today-tab").addClass('red-tab-underline');
            
            $("#coming-soon-tab").removeClass('black-tab-font').addClass('grey-tab-font');
            $("#coming-soon-tab").removeClass('red-tab-underline');
        
            $("#day7-container").removeClass('nodisplay');
            $("#day0-container").addClass('nodisplay');
            $("#day1-container").addClass('nodisplay');
            $("#day2-container").addClass('nodisplay');
            $("#day3-container").addClass('nodisplay');
            $("#day4-container").addClass('nodisplay');
            $("#day5-container").addClass('nodisplay');
            $("#day6-container").addClass('nodisplay');
        }

        if(tabName == 'Coming Soon'){
            $("#today-tab").removeClass('black-tab-font').addClass('grey-tab-font');
            $("#today-tab").removeClass('red-tab-underline');

            $("#coming-soon-tab").removeClass('grey-tab-font').addClass('black-tab-font');
            $("#coming-soon-tab").addClass('red-tab-underline');

            $("#day7-container").addClass('nodisplay');
            $("#day0-container").removeClass('nodisplay');
            $("#day1-container").removeClass('nodisplay');
            $("#day2-container").removeClass('nodisplay');
            $("#day3-container").removeClass('nodisplay');
            $("#day4-container").removeClass('nodisplay');
            $("#day5-container").removeClass('nodisplay');
            $("#day6-container").removeClass('nodisplay');
        }
    }

    function fullCalendars(){
        var dropdowns = document.getElementById("consumerroadmapwaag");
        //if(!dropdowns.classList.contains('display-dropdown'))
            $("#consumerroadmapwaag").addClass('display-dropdown');
        //else
        //    $("#consumerroadmapwaag").removeClass("display-dropdown");

    }

    window.onclick = function(event) {
        if (!event.target.matches('.dropdown-button')) {
            var dropdowns = document.getElementById("consumerroadmapwaag");
            console.log(dropdowns.classList);
            if(dropdowns != null && dropdowns.classList.contains('display-dropdown'))
                $("#consumerroadmapwaag").removeClass("display-dropdown");
        }
    }

    function checkCalendarViewComplete()
    {
        //userRoles = JSON.parse(sessionStorage.getItem("userRoles"));	
        userRoles = JSON.parse(localStorage.getItem("userRoles"));
        if (userRoles == null || userRoles.length == 0) 
        {
            window.setTimeout(checkCalendarViewComplete, 100); //this checks the flag every 100 miliseconds
        }
        else
            fnSetUserProfile();
    
    }
    
    function fnSetUserProfile()
    {
        // 08/14/20 - open up MyView to everyone - not yet
        //$("#myview").removeClass("nodisplay").addClass('display1');
        // userRoles are now stored in sessionStorage from UserPermission.html
        //userRoles = JSON.parse(sessionStorage.getItem("userRoles"));	
        userRoles = JSON.parse(localStorage.getItem("userRoles"));		
        if (userRoles == null)
            userRoles = [];	
            //|| userRoles[i] == "Sales Ops Admins" || userRoles[i] == "B2B Admins"
         for (i=0; i < userRoles.length; i++)
        {
            if (userRoles[i] == "CGTM Leads")
                isCGTM = true;

            if (userRoles[i] == "CGTM Leads" || userRoles[i] == "GTM HQ Super Admin" || userRoles[i] == "IMC Admins" || userRoles[i] == "PMO Admins" || userRoles[i] == "FWA PMO Admins"|| userRoles[i] == "Digital Ops Admins" || userRoles[i] == "Branding ADMINS" || userRoles[i] == "Sales Ops Admins" || userRoles[i] == "B2B Admins")
            {
                console.log("i am gtm");
                isGTM = true;  // turn off for test purposes
            }
            
            if (userRoles[i] == "Profile_Interlock_User")  //userRoles[i] == "Interlock User"
            {
                isInterlock = true;
                isEveryone = false;
            }
            
            if (userRoles[i] == "Profile_Director_VPs")  //userRoles[i] == "VPs and Directors"
            {
                isVPandDirector = true;
                isEveryone = false;
            }
            if (userRoles[i] == "Profile_Field_User")  //userRoles[i] == "Field DM IAMs and Support"
            {
                isFieldDM = true;
                isEveryone = false;
            }
    
            if (userRoles[i] == "Profile_GM_User")  //userRoles[i] == "Field DM IAMs and Support"
            {
                isGM = true;
                isEveryone = false;
            }
            
            if (userRoles[i] == "Profile_Calendar_User")
            {
                isCalendar = true;
                isEveryone = false;
            }
            
            if (userRoles[i] == "IMC Admins" || userRoles[i] == "Branding ADMINS")
            {
                if (securityLevel < 4)
                securityLevel = 4;
                isIMCAdmin = true;
            }
            
            if (userRoles[i] == "Digital Ops Admins")
            {
                if (securityLevel < 2)
                securityLevel = 2;
            }
            if (userRoles[i] == "PMO Admins")
            {
                if (securityLevel < 7)
                securityLevel = 7;  //7
                isPMO = true;			
            }
            if (userRoles[i] == "FWA PMO Admins")
            {
                if (securityLevel < 7)
                securityLevel = 7;  //7
                isFWAPMO = true;			
            }
            if(userRoles[i] == "Local Calendar View"){
                isLocal = true;
            }
            
            if (userRoles[i] == "Sales Ops Admins")
            {
                if (securityLevel < 4)
                securityLevel = 4;  //7
                isSalesOps = true;		
                isSalesOpsAdmin = true;	
            }
            
            if (userRoles[i] == "GTM HQ Super Admin")
            {
                securityLevel = 8;
            }
            if (userRoles[i] == "IMC HQ Calendar View")
            {
                if	(calendarLevel < 1)
                    calendarLevel = 1;
                isIMCHQ = true;
            }
            if (userRoles[i] == "IMC FA Calendar View")
            {
                if	(calendarLevel < 1)
                    calendarLevel = 1;
                isIMCFA = true;
            }
    
            if (userRoles[i] == "Branding Calendar View")
            {
                if	(calendarLevel < 1)
                    calendarLevel = 1;
                isBranding = true;
            }
            
            
            if (userRoles[i] == "DM_IDM_IAM Calendar View")
            {
                if	(calendarLevel < 1)
                    calendarLevel = 1;
                isDM = true;
            }
            
            if (userRoles[i] == "PMO Calendar View")
            {
                calendarLevel = 7;
                isPMO = true;
            }
            if (userRoles[i] == "FWA PMO CALENDAR VIEW")
            {
                calendarLevel = 7;
                isFWAPMO = true;
            }
            
            if (userRoles[i] == "Sales Ops Calendar View" || userRoles[i] == "Sales Ops Admins")
            {
                if	(calendarLevel < 1)
                    calendarLevel = 1;
                isSalesOps = true;
                isEveryone = false;
            }
            console.log(userRoles);
            if (userRoles[i] == "Unapproved Promo Calendar" || userRoles[i] == "DM Promo Team")
            {
                if (calendarLevel < 1)
                    calendarLevel = 1;  //7
                isUnapprovedPromo = true;		
            }
            if (userRoles[i] == "Sales Ops Calendar View GM_SM")
            {
                if (calendarLevel < 1)
                calendarLevel = 1;  //7
                isSalesOpsGMSM = true;		
            }
            if (userRoles[i] == "Sales Ops Calendar View Dir_VP")
            {
                if (calendarLevel < 1)
                calendarLevel = 1;  //7
                isSalesOpsExec = true;		
            }

            if (userRoles[i] == "Executive Calendar View")
		    {
			    $("#executivecalendar").removeClass("nodisplay").addClass('display');
		    	$("#executivecalendarwaag").removeClass("nodisplay").addClass('display');
            }

        }

        if(isCGTM)
            $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20My%20Calendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20My%20Calendar%20CGTM.aspx');

        if (isGTM)
        {
            isInterlock = false;
            isVPandDirector = false;
            isFieldDM = false;
            isGM = false;
            isCalendar = false;
            isEveryone = false;
            $("#alert").removeClass("nodisplay").addClass('display');
            $("#specialmessage").removeClass("nodisplay").addClass('display');
            $("#admin").removeClass("nodisplay").addClass('display1');
            //$("#archive").removeClass("nodisplay").addClass('display1');
    
            //$("#submitbrief").removeClass("nodisplay").addClass('display1');	
            //$("#myview").removeClass("nodisplay").addClass('display1');		
            //$("#retrospectives").removeClass("nodisplay").addClass('display1');
            //$("#infomanager").removeClass("nodisplay").addClass('display1');
            //$("#newreview").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            
            $("#executiveviewcell").removeClass("hidden").addClass('show');
            $("#executiveview").removeClass("nodisplay").addClass('display1');
            $("#executivelist").removeClass("nodisplay").addClass('display1');
            $("#executivecalendar").removeClass("nodisplay").addClass('display1');
            $("#executivecalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#fulllist").removeClass("nodisplay").addClass('display1');
            $("#fullcalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#fullcalendar").removeClass("nodisplay").addClass('display1');
            $("#dmlist").removeClass("nodisplay").addClass('display1');
            $("#dmcalendar").removeClass("nodisplay").addClass('display1');
            $("#dmcalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#gmlist").removeClass("nodisplay").addClass('display1');
            $("#gmcalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#gmcalendar").removeClass("nodisplay").addClass('display1');
            $("#salesopcalendar").removeClass("nodisplay").addClass('display1');
            $("#localcalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#localcalendar").removeClass("nodisplay").addClass('display1');

            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            // for test purposes only
            //$("#resourcecentral").removeClass("nodisplay").addClass('display1');
    
        }
        else if(isVPandDirector)
        {
            $("#alert").removeClass("nodisplay").addClass('display');
            $("#specialmessage").removeClass("nodisplay").addClass('display');
            //$("#archive").removeClass("nodisplay").addClass('display1');	
            $("#peak").removeClass("nodisplay").addClass('display1');
            $("#retrospectives").removeClass("nodisplay").addClass('display1');
    
            $("#ccrs").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            
            $("#executiveviewcell").removeClass("hidden").addClass('show');
            $("#executiveview").removeClass("nodisplay").addClass('display1');
            $("#executivelist").removeClass("nodisplay").addClass('display1');
            $("#executivecalendar").removeClass("nodisplay").addClass('display1');
            $("#executivecalendarwaag").removeClass("nodisplay").addClass('display1');

            $("#tmprequests").css({"display": "none"});
            $("#infomanager").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
    
            $("div[id='headerthisweek0']").css({"display": "none"});
            $("div[id='headernextweek0']").css({"display": "none"});
            $("div[id='headerthisweek4']").css({"display": "none"});
            $("div[id='headernextweek4']").css({"display": "none"});
            $("div[id='marketinginterlock']").css({"display": "none"});

            $("div[id='material0']").css({"display": "none"});
            $("div[id='archive0']").css({"display": "none"});
            $("div[id='material4']").css({"display": "none"});
            $("div[id='archive4']").css({"display": "none"});				
            
        }
        else if (isInterlock)
        {
            $("#alert").removeClass("nodisplay").addClass('display');
            $("#specialmessage").removeClass("nodisplay").addClass('display');
            //$("#archive").removeClass("nodisplay").addClass('display1');
            //$("#unboxd").removeClass("nodisplay").addClass('display1');
            //$("#retrospectives").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
        
            $("#executiveviewcell").removeClass("hidden").addClass('show');
            $("#executiveview").removeClass("nodisplay").addClass('display1');
            $("#executivelist").removeClass("nodisplay").addClass('display1');
            $("#executivecalendar").removeClass("nodisplay").addClass('display1');
            $("#executivecalendarwaag").removeClass("nodisplay").addClass('display1');

            //$("div[id='headerthisweek3']").css({"display": "none"});
            //$("div[id='headernextweek3']").css({"display": "none"});
            //$("div[id='material3']").css({"display": "none"});
            //$("div[id='archive3']").css({"display": "none"});	
            //$("div[id='fieldleadershipbriefing']").css({"display": "none"});	

            $("#tmprequests").css({"display": "none"});
            $("#infomanager").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
            //$("#retrospectives").css({"display": "none"});
            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            $("#secondarrows").css({"display": "none"});	
            $("#retrospectives").removeClass("nodisplay").addClass('display1');
                
        }
        else if(isCalendar)
        {
            if (darkIndicator != "1")
            {
                $("#alert").removeClass("nodisplay").addClass('display');
            }
            //$("#archive").removeClass("nodisplay").addClass('display1');	
            //$("#submitbrief").removeClass("nodisplay").addClass('display1');	
            //$("#myview").removeClass("nodisplay").addClass('display1');		
    
            //$("#retrospectives").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            $("#fulllist").removeClass("nodisplay").addClass('display1');
            $("#fullcalendar").removeClass("nodisplay").addClass('display1');
            $("#fullcalendarwaag").removeClass("nodisplay").addClass('display1');

            if(!isInterlock){
            $("div[id='headerthisweek0']").css({"display": "none"});
            $("div[id='headernextweek0']").css({"display": "none"});
            $("div[id='material0']").css({"display": "none"});
            $("div[id='archive0']").css({"display": "none"});		
            $("div[id='marketinginterlock']").css({"display": "none"});
            }
            
            //$("div[id='headerthisweek1']").css({"display": "none"});
            //$("div[id='headernextweek1']").css({"display": "none"});
            //$("div[id='material1']").css({"display": "none"});
            //$("div[id='archive1']").css({"display": "none"});		
            
            $("div[id='headerthisweek2']").css({"display": "none"});
            $("div[id='headernextweek2']").css({"display": "none"});
            $("div[id='material2']").css({"display": "none"});
            $("div[id='archive2']").css({"display": "none"});
            $("div[id='executivegtmbriefing']").css({"display": "none"});
        
            
            //02/01/2021 - open up Field Meeting for Profile_Calendar_User
            //$("div[id='headerthisweek3']").css({"display": "none"});
            //$("div[id='headernextweek3']").css({"display": "none"});
            //$("div[id='material3']").css({"display": "none"});
            //$("div[id='archive3']").css({"display": "none"});	
    
            $("div[id='headerthisweek4']").css({"display": "none"});
            $("div[id='headernextweek4']").css({"display": "none"});
            $("div[id='material4']").css({"display": "none"});
            $("div[id='archive4']").css({"display": "none"});	
            
            //$("#meetingsection").css({"display": "none"});
            $("#launcharrows2").css({"display": "none"});
            //$("#materialoutercontainer").css({"display": "none"});
            //$("#thisweekoutercontainer").css({"display": "none"});		
            //$("#nextweekoutercontainer").css({"display": "none"});
            //$("#archiveoutercontainer").css({"display": "none"});
    
            $("#tmprequests").css({"display": "none"});
            $("#infomanager").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            $("#retrospectives").removeClass("nodisplay").addClass('display1');
        }	
        else if(isFieldDM)
        {
            //permission change
            //isGM = false;
            if (darkIndicator != "1")
            {
                $("#alert").removeClass("nodisplay").addClass('display');
                $("#specialmessage").removeClass("nodisplay").addClass('display');
            }
            
            $("#peak").removeClass("nodisplay").addClass('display1');
            $("#ccrs").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            $("#dmlist").removeClass("nodisplay").addClass('display1');
            $("#dmcalendar").removeClass("nodisplay").addClass('display1');
            $("#dmcalendarwaag").removeClass("nodisplay").addClass('display1');

            if(!isInterlock){
            $("div[id='headerthisweek0']").css({"display": "none"});
            $("div[id='headernextweek0']").css({"display": "none"});
            $("div[id='material0']").css({"display": "none"});
            $("div[id='archive0']").css({"display": "none"});		
            $("div[id='marketinginterlock']").css({"display": "none"});
            }

            //$("div[id='headerthisweek1']").css({"display": "none"});
            //$("div[id='headernextweek1']").css({"display": "none"});
            //$("div[id='material1']").css({"display": "none"});
            //$("div[id='archive1']").css({"display": "none"});		
            
            $("div[id='headerthisweek2']").css({"display": "none"});
            $("div[id='headernextweek2']").css({"display": "none"});
            $("div[id='material2']").css({"display": "none"});
            $("div[id='archive2']").css({"display": "none"});	
            $("div[id='executivegtmbriefing']").css({"display": "none"});
    
            $("div[id='headerthisweek4']").css({"display": "none"});
            $("div[id='headernextweek4']").css({"display": "none"});
            $("div[id='material4']").css({"display": "none"});
            $("div[id='archive4']").css({"display": "none"});	
            
            $("#retrospectives").css({"display": "none"});
            $("#tmprequests").css({"display": "none"});
            $("#infomanager").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
        
            $("#secondarrows").css({"display": "none"});	
            $("#resourcecentral").removeClass("nodisplay").addClass('display1');
            //$("#sfdc").removeClass("nodisplay").addClass('display1');
            //$("#voice").removeClass("nodisplay").addClass('display1');
    
        }
        else if(isGM)
        {
            if (darkIndicator != "1")
            {
                $("#alert").removeClass("nodisplay").addClass('display');
                $("#specialmessage").removeClass("nodisplay").addClass('display');
            }
            
            $("#peak").removeClass("nodisplay").addClass('display1');
            $("#ccrs").removeClass("nodisplay").addClass('display1');
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            $("#gmlist").removeClass("nodisplay").addClass('display1');
            $("#gmcalendarwaag").removeClass("nodisplay").addClass('display1');
            $("#gmcalendar").removeClass("nodisplay").addClass('display1');

            if(!isInterlock){
            $("div[id='headerthisweek0']").css({"display": "none"});
            $("div[id='headernextweek0']").css({"display": "none"});
            $("div[id='material0']").css({"display": "none"});
            $("div[id='archive0']").css({"display": "none"});		
            $("div[id='marketinginterlock']").css({"display": "none"});
            }

            $("div[id='headerthisweek2']").css({"display": "none"});
            $("div[id='headernextweek2']").css({"display": "none"});
            $("div[id='material2']").css({"display": "none"});
            $("div[id='archive2']").css({"display": "none"});		
            $("div[id='executivegtmbriefing']").css({"display": "none"});

            $("div[id='headerthisweek4']").css({"display": "none"});
            $("div[id='headernextweek4']").css({"display": "none"});
            $("div[id='material4']").css({"display": "none"});
            $("div[id='archive4']").css({"display": "none"});	
            
            $("#retrospectives").css({"display": "none"});
            $("#tmprequests").css({"display": "none"});
            $("#infomanager").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
        
            $("#secondarrows").css({"display": "none"});	
            $("#resourcecentral").removeClass("nodisplay").addClass('display1');
            $("#meetingsection").css({"display": "none"});	
            $("#thisweekoutercontainer0").css({"display": "none"});
            $("#thisweekoutercontainer1").css({"display": "none"});
            $("#thisweekoutercontainer2").css({"display": "none"});
            $("#materialoutercontainer0").css({"display": "none"});
            $("#materialoutercontainer1").css({"display": "none"});
            $("#materialoutercontainer2").css({"display": "none"});
            $("#nextweekoutercontainer0").css({"display": "none"});
            $("#nextweekoutercontainer1").css({"display": "none"});
            $("#nextweekoutercontainer2").css({"display": "none"});
            $("#archiveoutercontainer").css({"display": "none"});
            $("#marketinginterlock").css({"display": "none"});
            $("#executivegtmbriefing").css({"display": "none"});
            $("#fieldleadershipbriefing").css({"display": "none"});
            $("#all-meetings").css({"display": "none"});

            $("#launcharrows2").css({"display": "none"});	
            $("#sfdc").removeClass("nodisplay").addClass('display1');
            $("#voice").removeClass("nodisplay").addClass('display1');
        }
        
    
        else if (isSalesOps || isSalesOpsGMSM || isSalesOpsExec)
        {
            //$("#submitbrief").removeClass("nodisplay").addClass('display1');	
            //$("#myview").removeClass("nodisplay").addClass('display1');	
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            $(".usertips").css({"display": "none"});
            $("#happeningcontainer").css({"display": "none"});
            $("#meetingbanner").css({"display": "none"});	
            $("#launcharrows1").css({"display": "none"});
            $("#launcharrows2").css({"display": "none"});
            $("#thisweekoutercontainer0").css({"display": "none"});
            $("#thisweekoutercontainer1").css({"display": "none"});
            $("#thisweekoutercontainer2").css({"display": "none"});
            $("#calendarcontainer").css({"display": "none"});
            $("#materialoutercontainer0").css({"display": "none"});
            $("#materialoutercontainer1").css({"display": "none"});
            $("#materialoutercontainer2").css({"display": "none"});
            $("#nextweekoutercontainer0").css({"display": "none"});
            $("#nextweekoutercontainer1").css({"display": "none"});
            $("#nextweekoutercontainer2").css({"display": "none"});
            $("#archiveoutercontainer").css({"display": "none"});
            $("#marketinginterlock").css({"display": "none"});
            $("#executivegtmbriefing").css({"display": "none"});
            $("#fieldleadershipbriefing").css({"display": "none"});
            $("#all-meetings").css({"display": "none"});

            $("#tmprequests").css({"display": "none"});
            $("#retrospectives").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            $(".footerstart").css({"margin-top": "78px"});
        
        }
        else if (isUnapprovedPromo)
        {
            console.log("i am unapproved");
            //$("#submitbrief").removeClass("nodisplay").addClass('display1');	
            //$("#myview").removeClass("nodisplay").addClass('display1');	
            $("#consumerroadmapwaag").removeClass("nodisplay").addClass('display1');
            $(".usertips").css({"display": "none"});
            $("#happeningcontainer").css({"display": "none"});
            $("#meetingbanner").css({"display": "none"});	
            $("#launcharrows1").css({"display": "none"});
            $("#launcharrows2").css({"display": "none"});
            $("#thisweekoutercontainer0").css({"display": "none"});
            $("#thisweekoutercontainer1").css({"display": "none"});
            $("#thisweekoutercontainer2").css({"display": "none"});
            $("#calendarcontainer").css({"display": "none"});
            $("#materialoutercontainer0").css({"display": "none"});
            $("#materialoutercontainer1").css({"display": "none"});
            $("#materialoutercontainer2").css({"display": "none"});
            $("#nextweekoutercontainer0").css({"display": "none"});
            $("#nextweekoutercontainer1").css({"display": "none"});
            $("#nextweekoutercontainer2").css({"display": "none"});
            $("#archiveoutercontainer").css({"display": "none"});
            $("#marketinginterlock").css({"display": "none"});
            $("#executivegtmbriefing").css({"display": "none"});
            $("#fieldleadershipbriefing").css({"display": "none"});
            $("#all-meetings").css({"display": "none"});

            $("#tmprequests").css({"display": "none"});
            $("#retrospectives").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            $(".footerstart").css({"margin-top": "78px"});
        }
        
        else if (isEveryone)
        {
            //$("#submitbrief").removeClass("nodisplay").addClass('display1');	
            //$("#myview").removeClass("nodisplay").addClass('display1');	
            $("#roadmap").remove();   //08/09/21 change
            $("#consumerroadmapwaag").remove();
            $(".usertips").css({"display": "none"});
            //$("#happeningcontainer").css({"display": "none"}); //08/09/21 change
            $("#meetingbanner").css({"display": "none"});	
            $("#launcharrows1").css({"display": "none"});
            $("#launcharrows2").css({"display": "none"});
            $("#thisweekoutercontainer0").css({"display": "none"});
            $("#thisweekoutercontainer1").css({"display": "none"});
            $("#thisweekoutercontainer2").css({"display": "none"});
            $("#calendarcontainer").css({"display": "none"});
            $("#materialoutercontainer0").css({"display": "none"});
            $("#materialoutercontainer1").css({"display": "none"});
            $("#materialoutercontainer2").css({"display": "none"});
            $("#nextweekoutercontainer0").css({"display": "none"});
            $("#nextweekoutercontainer1").css({"display": "none"});
            $("#nextweekoutercontainer2").css({"display": "none"});
            $("#archiveoutercontainer").css({"display": "none"});
            $("#marketinginterlock").css({"display": "none"});
            $("#executivegtmbriefing").css({"display": "none"});
            $("#fieldleadershipbriefing").css({"display": "none"});
            $("#all-meetings").css({"display": "none"});
            $("#meetingsection").css({"display": "none"});
            $("#day2-container").css({"display": "none"});
            $("#day3-container").css({"display": "none"});
            $("#day4-container").css({"display": "none"});
            $("#day5-container").css({"display": "none"});
            $("#day6-container").css({"display": "none"});

            $("#tmprequests").css({"display": "none"});
            $("#retrospectives").css({"display": "none"});
            $("#newandreview").css({"display": "none"});
            $("#peak").css({"display": "none"});
            $("#ccrs").css({"display": "none"});
            $(".footerstart").css({"margin-top": "78px"});
            $("#historical").css({"display": "none"});	// 04.09.21 - do not show historical to "Everyone"
            $("#fwaplaybook").css({"display": "none"});	
            $("#fieldqa").css({"display": "none"});	
        }
        setPersonalIcons();
    }
    
    function setPersonalIcons()
    {
        if (securityLevel > 0)
        {
            $("#adminview").removeClass("nodisplay").addClass('display');
            if (securityLevel == 1)
            {
                if (isInternalComm)
                    $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20IC%20Calendar.aspx');
        
            }
            if (securityLevel == 2)
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20DO%20Admin%20View.aspx');
            if (securityLevel == 4)
            {
                if (isIMCAdmin)
                    $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20IMC%20Admin%20View.aspx');
                else  if (isSalesOpsAdmin)
                {
                    $("#admin").removeClass("nodisplay").addClass('display1');
                    $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Sales%20Ops%20Admin%20View.aspx');
                }
            }
            /*if (securityLevel == 5)
            {
                $("a[href='https://esites.vzbi.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://esites.vzbi.com/sites/HQ_GTM/SitePages/GTM%20Consumer%20Ops%20Admin%20View.aspx');
            }
            if (securityLevel == 6)
                $("a[href='https://esites.vzbi.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://esites.vzbi.com/sites/HQ_GTM/SitePages/GTM%20MediaCo%20Admin%20View.aspx');*/
            if (securityLevel == 7)
            {
                if (isPMO)
                    $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20PMO%20Admin%20View.aspx');
                if (isFWAPMO)
                    $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Admin%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20FWA%20PMO%20Admin%20View.aspx');
            }	
        }
        console.log("calendarLevel " + calendarLevel);
        if (calendarLevel == 1)
        {
            if (isIMCHQ)
            {
                $("#imhqcalendarwaag").removeClass("nodisplay").addClass("display");
                $("#imhqcalendar").removeClass("nodisplay").addClass("display");	
            }
            if(isLocal){
                $("#localcalendarwaag").removeClass("nodisplay").addClass("display1");
                $("#localcalendar").removeClass("nodisplay").addClass("display1");
            }
            if (isIMCFA)
            {
                $("#imfacalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#imfacalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isBranding)
            {
                $("#brandcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#brandcalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isSalesOps)
            {
                $("#salesops").removeClass("nodisplay").addClass("display");	
                $("#salesopscalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isSalesOpsGMSM)
            {
                $("#salesopsgmsm").removeClass("nodisplay").addClass("display");	
                $("#salesopsgmsmcalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isSalesOpsExec)
            {
                $("#salesopsexec").removeClass("nodisplay").addClass("display");	
                $("#salesopsexeccalendar").removeClass("nodisplay").addClass("display");	
            }
            
            if (isUnapprovedPromo)
            {
                console.log("showing unapproved");
                $("#unapprovedwaag").removeClass("nodisplay").addClass("display");	
                $("#unapproved").removeClass("nodisplay").addClass("display");	
                $("#unapprovedcalendar").removeClass("nodisplay").addClass("display");	
            }
            
            if (isPMO)
            {
                $("#pmocalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#pmocalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isFWAPMO)
            {
                $("#fwapmocalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#fwapmocalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isDM)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Calendar%20View.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM DM Calendar View.aspx');
                $("#calendarview").removeClass("nodisplay").addClass("display");	
            }

            //permission changes
            if (isFieldDM){
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }
            
            if (isCalendar)
            {
                $("#fullcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#fullcalendar").removeClass("nodisplay").addClass("display");	
            }

            if (isDM)
            {
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isGM){
                $("#gmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#gmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isFWAPMO){
                $("#fwapmocalendar").removeClass("nodisplay").addClass("display");	
                $("#fwapmocalendarwaag").removeClass("nodisplay").addClass("display");	
            }

            if(isInterlock){
                $("div[id='headerthisweek0']").css({"display":"block"});
                $("div[id='headernextweek0']").css({"display":"block"});
                $("div[id='material0']").css({"display":"block"});
                $("div[id='archive0']").css({"display":"block"});	
                $("div[id='marketinginterlock']").css({"display":"inherit"});	
            }
            //up to here
        }
        else if (calendarLevel == 5)
            $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM Consumer Ops Calendar View.aspx');		
        else if (calendarLevel == 7)
        {
            if (isIMCHQ)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM IMC Calendar View.aspx');
                $("#imhqcalendarwaag").removeClass("nodisplay").addClass("display");
                $("#imhqcalendar").removeClass("nodisplay").addClass("display");		
		
            }
            if(isLocal){
                $("#localcalendarwaag").removeClass("nodisplay").addClass("display1");
                $("#localcalendar").removeClass("nodisplay").addClass("display1");

            }
            if (isIMCFA)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20IMC%20Field%20Activation%20Calendar%20View.aspx');
                $("#imfacalendarwaag").removeClass("nodisplay").addClass("display");		
                $("#imfacalendar").removeClass("nodisplay").addClass("display");		

            }
            if (isBranding)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Brand%20Calendar%20View.aspx');
                $("#brandcalendarwaag").removeClass("nodisplay").addClass("display");		
                $("#brandcalendar").removeClass("nodisplay").addClass("display");		
            }
            
            if (isPMO)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM PMO Calendar View.aspx');
                $("#pmocalendarwaag").removeClass("nodisplay").addClass("display");		
                $("#pmocalendar").removeClass("nodisplay").addClass("display");		

            }
            
            if (isFWAPMO)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM FWA PMO Calendar View.aspx');
                $("#fwapmocalendarwaag").removeClass("nodisplay").addClass("display");		
                $("#fwapmocalendar").removeClass("nodisplay").addClass("display");		
            }
            
            if (isSalesOps)
            {
                $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/ChannelCalendar.aspx']").attr('href', 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Sales%20Ops%20Calendar%20View.aspx');
                $("#salesops").removeClass("nodisplay").addClass("display");	
                $("#salesopscalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isUnapprovedPromo)
            {
                $("#unapprovedwaag").removeClass("nodisplay").addClass("display");	
                $("#unapproved").removeClass("nodisplay").addClass("display");	
                $("#unapprovedcalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isSalesOpsGMSM)
            {
                $("#salesopsgmsm").removeClass("nodisplay").addClass("display");	
                $("#salesopsgmsmcalendar").removeClass("nodisplay").addClass("display");	
            }
            if (isSalesOpsExec)
            {
                $("#salesopsexec").removeClass("nodisplay").addClass("display");	
                $("#salesopsexeccalendar").removeClass("nodisplay").addClass("display");	
            }

            //permission changes
            if (isFieldDM){
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }
            
            if (isCalendar)
            {
                $("#fullcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#fullcalendar").removeClass("nodisplay").addClass("display");	
            }

            if (isDM)
            {
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isGM){
                $("#gmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#gmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isFWAPMO){
                $("#fwapmocalendar").removeClass("nodisplay").addClass("display");	
                $("#fwapmocalendarwaag").removeClass("nodisplay").addClass("display");	
            }
            //up to here
            
        }  else {
            if(isLocal){
                $("#localcalendarwaag").removeClass("nodisplay").addClass('display1');
                $("#localcalendar").removeClass("nodisplay").addClass('display1');
            }

            //permission changes
            if (isFieldDM){
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }
            
            if (isCalendar)
            {
                $("#fullcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#fullcalendar").removeClass("nodisplay").addClass("display");	
            }

            if (isDM)
            {
                $("#dmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#dmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isGM){
                $("#gmcalendarwaag").removeClass("nodisplay").addClass("display");	
                $("#gmcalendar").removeClass("nodisplay").addClass("display");	
            }

            if(isInterlock){
                $("div[id='headerthisweek0']").css({"display":"block"});
                $("div[id='headernextweek0']").css({"display":"block"});
                $("div[id='material0']").css({"display":"block"});
                $("div[id='archive0']").css({"display":"block"});	
                $("div[id='marketinginterlock']").css({"display":"inherit"});	
            }

            if(isFWAPMO){
                $("#fwapmocalendar").removeClass("nodisplay").addClass("display");	
                $("#fwapmocalendarwaag").removeClass("nodisplay").addClass("display");	
            }
            //up to here
        }
    }
    
    /*function getHappenings(){
    
        var url = "https://esites.vzbi.com/sites/HQ_GTM";
        var listname = "GTM Dynamic Brief";
        var fields = "<ViewFields  Properties='False'><FieldRef Name='Project_x0020_Name'/><FieldRef Name='Launch_x0020_Date'/><FieldRef Name='Priority_x0020_Level'/><FieldRef Name='Created'/><FieldRef Name='Promotional_x0020_Timeframe_x003'/><FieldRef Name='Launch_x0020_Date_x0020_Modified'/><FieldRef Name='Should_x0020_this_x0020_be_x0020'/><FieldRef Name='Date_x0028_s_x0029_'/><FieldRef Name='Merchandising_x0020_Available_x0'/><FieldRef Name='Merchandising_x0020_Links'/><FieldRef Name='Training_x0020_Launch_x0020_Date'/><FieldRef Name='Training_x0020_Links'/><FieldRef Name='Priority_x0020_Assigned_x0020_Da'/></ViewFields>";
        var query = '<Query><OrderBy><FieldRef Name="Parent_x0020_Launch_x0020_Date_x"/><FieldRef Name="Project_x0020_Name_x0020_Sort"/></OrderBy><Where><And><And><And><Or><Or><Eq><FieldRef Name="Launch_x0020_Date_x0020__x0028_t"/><Value Type="Text">TBD</Value></Eq><Geq><FieldRef Name="Promotional_x0020_Timeframe_x003"/><Value Type="DateTime"><Today OffsetDays="-7"/></Value></Geq></Or><Geq><FieldRef Name="Launch_x0020_Date"/><Value Type="DateTime"><Today OffsetDays="-7"/></Value></Geq></Or><Neq><FieldRef Name="Priority_x0020_Level"/><Value Type="Text">SU</Value></Neq></And><Eq><FieldRef Name="GTM_x0020_Status"/><Value Type="Text">Assigned</Value></Eq></And><Eq><FieldRef Name="isB2B"/><Value Type="Text">Consumer</Value></Eq></And></Where></Query>';		
        var spPromise =  $().SPServices({
              operation: "GetListItems",
              webURL: url,
              listName: listname,
              CAMLViewFields: fields,
              CAMLQuery: query,
              async: false
        });
        //curSource[0] = cssEvents; 			// CSS meetings
        //curSource[1] = executiveEvents; 	// Executive GTM meetings
        //curSource[2] = interlockEvents; 	// interlock meetings
        //curSource[3] = leadershipEvents; 	// field leadership meetings
        spPromise.done(function(){
            $(spPromise.responseXML).SPFilterNode("z:row").each(function() {
                var $node = $(this);
                // Get the start and end date/time of the event. fullcalendar will parse date strings in local time automagically, so we need to convert the UTC 
                //date strings from SharePoint into local time. The formatDateToLocal() function above will take care of this. See comments in that function for more information.
                var executiveDate, interlockDate, leadershipDate;
                
                var launchDate = $( this ).Launch_x0020_Date' );
        
                var trainingDate = $( this ).Training_x0020_Launch_x0020_Date' );
                
                var merchandisingDate = $( this ).Merchandising_x0020_Available_x0' );
        
                if (trainingDate != null)
                    storeMeetingItem($node,"Training",trainingDate,"","noappendix");
                if (merchandisingDate != null)
                    storeMeetingItem($node,"Merchandising",merchandisingDate,"","noappendix");
        
                    
                storeMeetingItem($node,"Calendar",launchDate,"","noappendix");
            });					
            curSource[4] = calendarEvents; 		// all launches, including Training and Merchandising
            setCalendarItems();
        });
        spPromise.error(function(){
            console.log("spPromise.error");
        });
    
    }*/
    
    function getHappenings()
    {
        // 03/10/2020 - add &$ to select  - this will aleviate issues with too many "multiple person" columns
    
        var today = new Date();
        var last7Days = new Date();
        var last4Days = new Date();
        last7Days = addDays(today, -7);  // changed from -7
        last7Days = last7Days.format("yyyy-MM-ddT00:00:00Z");
        last4Days = addDays(today, -4);  // changed from -7
        last4Days = last4Days.format("yyyy-MM-ddT00:00:00Z");
        
        var url = "https://onesite.verizon.com/sites/HQ_GTM";
        var listname = "GTM Dynamic Brief";
        // remove and GTM_x0020_Status eq 'Assigned' - CRM does not require an Assigned Status of GTM
        // use launch date modified instead of null launch date, it does not work  - Launch_x0020_Date_x0020_Modified  .  OLD logic:  Launch_x0020_Date eq datetime'1900-01-01T00:00:00'
        
        // changed to sort items by priority first
        //var query = "?$filter=(Launch_x0020_Date ge DateTime'" + last7Days + "' or Launch_x0020_Date_x0020_Modified ge DateTime'" + last4Days + "' or Promo_x0020_End_x0020_Date_x0020 ge DateTime'" + last4Days + "' or Promotional_x0020_Timeframe_x003 ge DateTime'" + last4Days + "') and  (isB2B ne '' and (isB2B eq 'GTM')) and (Priority_x0020_Level eq '1' or Priority_x0020_Level eq '2' or Priority_x0020_Level eq '3' or Priority_x0020_Level eq '4')&$select=ID,isB2B,Project_x0020_Name,Launch_x0020_Date,Launch_x0020_Type,Priority_x0020_Level,GTM_x0020_Status,Support_x0020_Team_x0028_s_x0029,Launch_x0020_Date_x0020_Modified,Created,Promotional_x0020_Timeframe_x003,Should_x0020_this_x0020_be_x0020,Date_x0028_s_x0029_,Training_x0020_Links,Priority_x0020_Assigned_x0020_Da,Parent_x0020_Launch_x0020_Date_x,Project_x0020_Name_x0020_Sort,Promotion_x0020_Extended,Promo_x0020_End_x0020_Date_x0020,Parent_x0020_Project_x0020_ID0Id&$orderby=Launch_x0020_Date,Priority_x0020_Level,Project_x0020_Name,Child_x0020_Sequence_x0020_No&$top=800";		
        var query = "?$filter=(Launch_x0020_Date ge DateTime'" + last7Days + "' or Launch_x0020_Date_x0020_Modified ge DateTime'" + last4Days + "' or Promo_x0020_End_x0020_Date_x00200 ge DateTime'" + last4Days + "' or Promotional_x0020_Timeframe_x003 ge DateTime'" + last4Days + "') and  (isB2B ne '' and (isB2B eq 'GTM')) and (Priority_x0020_Level eq '1' or Priority_x0020_Level eq '2' or Priority_x0020_Level eq '3' or Priority_x0020_Level eq '4')&$select=ID,isB2B,Project_x0020_Name,Launch_x0020_Date,Launch_x0020_Type,Priority_x0020_Level,GTM_x0020_Status,Support_x0020_Team_x0028_s_x0029,Launch_x0020_Date_x0020_Modified,Created,Promotional_x0020_Timeframe_x003, Promo_x0020_End_x0020_Date_x00200, Promo_x0020_End_x0020_Date_x0020, Should_x0020_this_x0020_be_x0020,Date_x0028_s_x0029_,Training_x0020_Links,Priority_x0020_Assigned_x0020_Da,Parent_x0020_Launch_x0020_Date_x,Project_x0020_Name_x0020_Sort,Promotion_x0020_Extended,Parent_x0020_Project_x0020_ID0Id&$orderby=Priority_x0020_Level,Project_x0020_Name,Child_x0020_Sequence_x0020_No&$top=800";		

        //08/09/21 - if it's "Everyone", restrict last7days to today, and next 3 days
        if (isEveryone)
        {
            console.log("i am everyone");
            var next3Days = addDays(today, 3);
            today = today.format("yyyy-MM-ddT00:00:00Z");
            next3Days = next3Days.format("yyyy-MM-ddT00:00:00Z");
            
            // changed to sort items by priority first
            // query = "?$filter=(Launch_x0020_Date ge DateTime'" + today + "' and Launch_x0020_Date le DateTime'" + next3Days + "') and (isB2B ne '' and (isB2B eq 'GTM')) and (Priority_x0020_Level eq '1' or Priority_x0020_Level eq '2' or Priority_x0020_Level eq '3' or Priority_x0020_Level eq '4')&$select=ID,isB2B,Project_x0020_Name,Launch_x0020_Date,Launch_x0020_Type,Priority_x0020_Level,GTM_x0020_Status,Support_x0020_Team_x0028_s_x0029,Launch_x0020_Date_x0020_Modified,Created,Promotional_x0020_Timeframe_x003,Should_x0020_this_x0020_be_x0020,Date_x0028_s_x0029_,Training_x0020_Links,Priority_x0020_Assigned_x0020_Da,Parent_x0020_Launch_x0020_Date_x,Project_x0020_Name_x0020_Sort,Promotion_x0020_Extended,Promo_x0020_End_x0020_Date_x0020,Parent_x0020_Project_x0020_ID0Id&$orderby=Launch_x0020_Date,Priority_x0020_Level,Project_x0020_Name,Child_x0020_Sequence_x0020_No&$top=800";	
            query = "?$filter=(Launch_x0020_Date ge DateTime'" + today + "' and Launch_x0020_Date le DateTime'" + next3Days + "') and (isB2B ne '' and (isB2B eq 'GTM')) and (Priority_x0020_Level eq '1' or Priority_x0020_Level eq '2' or Priority_x0020_Level eq '3' or Priority_x0020_Level eq '4')&$select=ID,isB2B,Project_x0020_Name,Launch_x0020_Date,Launch_x0020_Type,Priority_x0020_Level,GTM_x0020_Status,Support_x0020_Team_x0028_s_x0029,Launch_x0020_Date_x0020_Modified,Created,Promotional_x0020_Timeframe_x003,Should_x0020_this_x0020_be_x0020,Date_x0028_s_x0029_,Training_x0020_Links,Priority_x0020_Assigned_x0020_Da,Parent_x0020_Launch_x0020_Date_x,Project_x0020_Name_x0020_Sort,Promotion_x0020_Extended,Promo_x0020_End_x0020_Date_x00200,Parent_x0020_Project_x0020_ID0Id&$orderby=Priority_x0020_Level,Project_x0020_Name,Child_x0020_Sequence_x0020_No&$top=800";	
        }
        
    
        $.ajax({
            async: false,
            url: url + "/_api/web/lists/getbytitle('" + listname + "')/items" + query,
            //CAMLViewFields: viewFields,
            method: "GET",
            async: false,
            headers: { "Accept": "application/json; odata=verbose" },
            success: function (data) {
                //complete(data); // Returns JSON collection of the results
                var stringData = JSON.stringify(data);
                var jsonObject = JSON.parse(stringData);
                var results = jsonObject.d.results;
                for(i = 0; i < results.length;i++) {
                    var executiveDate, interlockDate, leadershipDate;
                    
                    var launchDate = results[i].Launch_x0020_Date;
                    //var trainingDate = results[i].Training_x0020_Launch_x0020_Date;
                    
                    //var merchandisingDate = results[i].Merchandising_x0020_Available_x0;
                    
                    var status = results[i].GTM_x0020_Status; 
                    var supportteam = results[i].Support_x0020_Team_x0028_s_x0029;
            
                    /* 11/13/2020 - no longer display Training and Merchandising
                    if (trainingDate != null)
                        storeMeetingItem(results[i],"Training",trainingDate,"","noappendix");
                    if (merchandisingDate != null)
                        storeMeetingItem(results[i],"Merchandising",merchandisingDate,"","noappendix");*/
                    // #686 - remove parent projects from view	
                    var parentid = results[i].Parent_x0020_Project_x0020_ID0Id;
                    var index = 0;
                    if (parentid != null)
                    {
                        index = parentid.toString().indexOf(";");
                        if (index >= 0)
                            parentid = parentid.substring(0, index);
                    }
                    else
                        parentid = 0;
                    var launchtype = results[i].Launch_x0020_Type;
                    if (parentid != results[i].ID) // - DO NOT hide Parent record that are not Promotion - 09/23/20 request by Jen				
                    {
                        if ((supportteam.toString().indexOf("CRM") > 0) || (status == "Assigned"))
                            storeMeetingItem(results[i],"Calendar",launchDate,"","noappendix");	
                    }
                    else
                    {
                        if (launchtype != 'Promotion')
                            storeMeetingItem(results[i],"Calendar",launchDate,"","noappendix");	
    
                    }
                    
               } 
               curSource[4] = calendarEvents;
            },
            error: function (err) {
                //failure(data);
                alert ("SPGetListItems failed with error" + JSON.stringify(err));
            }
        });
    }
    function getMeetingAgendas(){
        // 03/276/2020 - remove Meeting_x0020_Type
        var today = new Date();
        var last7Days = new Date();
        var  next15Days = new Date();
        last7Days = addDays(today, -7);
        last7Days = last7Days.format("yyyy-MM-ddT00:00:00Z");
        next15Days = addDays(today, +15);
        next15Days = next15Days .format("yyyy-MM-ddT00:00:00Z");
        // 03/02/2020 comment out ConfigNotes - replace it with new column Appendix?
        
        var url = "https://onesite.verizon.com/sites/HQ_GTM";
        var listname = "GTM Meeting Agendas";
        var query = "?$filter=(Meeting_x0020_Date ge DateTime'" + last7Days + "' and  Meeting_x0020_Date le DateTime'" + next15Days + "') &$select=ID,Should_x0020_this_x0020_be_x0020,Meeting_x0020_Date,Meeting,Topic,Presenter,Meeting_x0020_Time,Created,Should_x0020_this_x0020_be_x0020&$orderby=Appendix_x003F_,Topic";
        $.ajax({
            async: false,
            url: url + "/_api/web/lists/getbytitle('" + listname + "')/items" + query,
            //CAMLViewFields: viewFields,
            method: "GET",
            async: false,
            headers: { "Accept": "application/json; odata=verbose" },
            success: function (data) {
                //complete(data); // Returns JSON collection of the results
                var stringData = JSON.stringify(data);
                var jsonObject = JSON.parse(stringData);
                var results = jsonObject.d.results;
                for(i = 0; i < results.length;i++) {
    
                    // Get the start and end date/time of the event. FullCalendar will parse date strings in local time automagically, so we need to convert the UTC 
                    //date strings from SharePoint into local time. The formatDateToLocal() function above will take care of this. See comments in that function for more information.
    
                    var executiveDate=null, interlockDate=null, leadershipDate=null, b2bInterlockDate=null;
                    var dark = results[i].Should_x0020_this_x0020_be_x0020;
                    if (dark == null)
                        dark = "";
                    var meeting = results[i].Meeting;
                    if (meeting == 'Exec GTM')
                        executiveDate = results[i].Meeting_x0020_Date;
                    else if (meeting == 'Field GTM')
                        leadershipDate = results[i].Meeting_x0020_Date;
                    else if (meeting == 'Interlock')// || meeting == 'Interlock - Digital')//(meeting.indexOf('Interlock') >=0)  -- this does not work
                        interlockDate = results[i].Meeting_x0020_Date;
                    else if (meeting == 'B2B/Consumer Interlock')
                        b2bInterlockDate = results[i].Meeting_x0020_Date;
                    
                    if (dark == "")  // display non-dark meeting agendas only
                    {	
                        if (executiveDate != null)
                        {
                            storeMeetingAgenda(results[i],"Executive",executiveDate);
                        }
                        if (interlockDate != null)
                            storeMeetingAgenda(results[i],"Interlock",interlockDate);
                        if (isFieldDM) 
                        {
                            //if (leadershipDate != null && dark == "" )
                            storeMeetingAgenda(results[i],"Leadership",leadershipDate);
                        }
                        else
                        {
                            if (leadershipDate != null)
                                storeMeetingAgenda(results[i],"Leadership",leadershipDate);
                        }
                        if (b2bInterlockDate != null)
                            storeMeetingAgenda(results[i],"B2BInterlock",b2bInterlockDate);
                    }
                }
            },
            error: function (err) {
                //failure(data);
                alert ("SPGetListItems failed with error" + JSON.stringify(err));
            }
        });
        curSource[1] = executiveEvents; 	// Executive GTM meetings
        curSource[2] = interlockEvents; 	// interlock meetings
        curSource[3] = leadershipEvents; 	// field leadership meetings
        curSource[0] = b2bInterlockEvents; 	// B2B Interlock meetings 
        
    }
    
    
    function storeMeetingItem(item,meetingType,meetingDate,meetingPresenter,isAppendix)
    {
        if (item.Launch_x0020_Date != null)
        {
            var thisLaunchDate = moment.utc(item.Launch_x0020_Date).format('MM/DD/YYYY');
            //thisLaunchDate = thisLaunchDate.format('MM/dd/yyyy');
        }
        else
            var thisLaunchDate = "TBD";
        if (item.Promotional_x0020_Timeframe_x003 != null)
        {
            var thisPromoEndDate = moment.utc(item.Promotional_x0020_Timeframe_x003).format('MM/DD/YYYY');
            //thisPromoEndDate = thisPromoEndDate.format('MM/dd/yyyy');
        }
        else
            var thisPromoEndDate = "";
            
        if (item.Launch_x0020_Date_x0020_Modified != null)
        {
            var launchDateChanged = moment.utc(item.Launch_x0020_Date_x0020_Modified).format('MM/DD/YYYY');
            //launchDateChanged = launchDateChanged.format('MM/dd/yyyy');
        }
        else
            var launchDateChanged = "";
    
        if (item.Promo_x0020_End_x0020_Date_x00200 != null)
        {
            var promoDateChanged = moment.utc(item.Promo_x0020_End_x0020_Date_x00200).format('MM/DD/YYYY');
        }
        else
            var promoDateChanged = "";
        //var createdDate = moment.utc(item.Created);
        var createdDate = moment.utc(item.Priority_x0020_Assigned_x0020_Da).format('MM/DD/YYYY');
        //createdDate = new Date(createdDate).format('MM/dd/yyyy');
        var thisStart = moment.utc(meetingDate).format('MM/DD/YYYY');
        //var thisStartDate = moment.utc(thisStart);
        var thisStartDate = thisStart;// .format('MM/dd/yyyy');
        var weekDayName =  moment.utc(thisStart).format('dddd'); 
        //populateHiddenDays(weekDayName);                    
        var thisEndDate = moment.utc(thisStart);
        var isDark = item.Should_x0020_this_x0020_be_x0020;
    
        var thisID = item.ID;  //.split( ';#' ).join( '.' );
        var className, thisTitle;
        // FullCalendar documentation specifies that recurring events should all have the same id value when building the events array (the id is optional, 
        //but I'm including it for completeness). We can get the list item ID (which is the same for all instances of recurring events) without the recurrence 
        //information by simply splitting thisID.
        var eventID = thisID;//.split( '.' )[0];
        var priority = item.Priority_x0020_Level;
        var presenter = meetingPresenter;
        if (presenter != "" && typeof presenter != 'undefined')
            presenter = " - " + presenter;	
        else
            presenter = "";
    
        var appendix = item.Appendix_x0020_Only;
        if (appendix != "" && typeof appendix != 'undefined')
            appendix = "<span class='boldfont red'>Appendix: </span>";	
        else
            appendix = "";
        var thisDesc = item.Project_x0020_Name; //"•" +
        var href = 'https://onesite.verizon.com/sites/HQ_GTM/Lists/GTM%20Dynamic%20Brief/PopupDisplay.aspx?ID=' + eventID;	
        thisDesc = "<a href=javascript:OpenPopUpPageWithTitle('" + href  + "',null,740,800," + "\"&nbsp;" + "\")>" + thisDesc + "</a>";
        var dates = item.Date_x0028_s_x0029_;	 
        /* task #685 - 01.13.2020 - no longer need training and merchandising
        if (meetingType == 'Training')
        {
            var internaldates = item.Date_x0028_s_x0029_;
            internaldates = internaldates.replace(/string;#/g,'');
            internaldates = internaldates.replace(/\//g, '.');
            thisDesc = item.Project_x0020_Name + " - " + internaldates + ":" + item.Training_x0020_Links;
            var thisTrainingDate = moment.utc(item.Training_x0020_Launch_x0020_Date).format('MM/DD/YYYY');
            //thisTrainingDate = new Date(thisTrainingDate).format('MM/dd/yyyy');
        }
        if (meetingType == 'Merchandising')
        {
            var internaldates = item.Date_x0028_s_x0029_;
            internaldates = internaldates.replace(/string;#/g,'');
            internaldates = internaldates.replace(/\//g, '.');
            thisDesc = item.Project_x0020_Name + " - " + internaldates + ":" + item.Merchandising_x0020_Links;
            var thisMerchandisingDate = moment.utc(item.Merchandising_x0020_Available_x0).format('MM/DD/YYYY');
            //thisMerchandisingDate = new Date(thisMerchandisingDate).format('MM/dd/yyyy');
        }*/
        
        var desc = meetingType;
    
        // Add the event information to the events array so FullCalendar can display it.
        //CSS is now Consumer Staff, Director is Executive GTM
        if (priority != "unassigned" && meetingType == "Calendar")
        {
            calendarEvents.push({
                title: thisDesc,
                id: eventID,
                description: desc,
                start: thisLaunchDate,
                end: thisPromoEndDate,
                training:"",
                merchandising:"",			
                created: createdDate,
                className: className,
                orderfield: priority,
                launchdate: thisLaunchDate,
                launchdatechange: launchDateChanged,
                promodatechange: promoDateChanged,
                isdark: isDark,
                borderColor: '#fff',
                textEscape: false,
                dates: dates,
                url: URL,
                extended: item.Promotion_x0020_Extended,
                managingchannel: item.isB2B,
                launchtype: item.Launch_x0020_Type,
                gtmstatus: item.GTM_x0020_Status
            });
        }
        // add items for meeting calendars
        {
            priority = meetingType + priority + thisLaunchDate;  
            /*  task # 685 - no longer need training or merchandising
            if (meetingType == "Training")
                calendarEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisTrainingDate,
                    end: "",
                    training:thisTrainingDate,
                    merchandising:"",
                    isdark: isDark,
                    created: createdDate,
                    className: className,
                    orderfield: priority,
                    launchdate: thisLaunchDate,
                    borderColor: '#fff',
                    textEscape: false,
                    dates: dates,
                    url: URL
                });	
            if (meetingType == "Merchandising")
                calendarEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisMerchandisingDate,
                    end: "",
                    training: "",
                    merchandising:thisMerchandisingDate,
                    isdark: isDark,
                    created: createdDate,
                    className: className,
                    orderfield: priority,
                    launchdate: thisLaunchDate,
                    borderColor: '#fff',
                    textEscape: false,
                    dates: dates,
                    url: URL
                });	*/					
                    
        }  // end of if (priority != "unassigned")
    }
    
    function storeMeetingAgenda(item,meetingType,meetingDate)
    {
        var createdDate = moment.utc(item.Created).format('MM/DD/YYYY');
        //createdDate = new Date(createdDate).format('MM/dd/yyyy');
        var thisStart = moment.utc(meetingDate).format('MM/DD/YYYY');
        var thisStartDate = thisStart;//.format('MM/dd/yyyy');
        var weekDayName =  moment.utc(thisStart).format('dddd');
        var thisEndDate = moment.utc(thisStart);
        var thisID = item.ID;
        var className, thisTitle;
        var eventID = thisID;
        var thisDesc = "<span>" + item.Topic + "</span>"; //"•" +
        var desc = meetingType;
        var presenter = item.Presenter;
        if (presenter != null && presenter.toLowerCase() == "appendix")
            thisDesc = item.Topic + " - <span style='font-style:italic'>appendix</span>";
        // add items for meeting calendars
        {
            if (meetingType == "Executive")
                executiveEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisStartDate,
                    end: thisStartDate,
                    created: createdDate,				
                    borderColor: '#fff',
                    textEscape: false,
                    url: URL
                });	
            else if (meetingType == "Interlock")
                interlockEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisStartDate,
                    end: thisStartDate,
                    created: createdDate,				
                    borderColor: '#fff',
                    textEscape: false,
                    url: URL
                });	
            else if (meetingType == "Leadership")
                leadershipEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisStartDate,
                    end: thisStartDate,
                    created: createdDate,				
                    borderColor: '#fff',
                    textEscape: false,
                    url: URL
                });	
            else if (meetingType == "B2BInterlock")
                b2bInterlockEvents.push({
                    title: thisDesc,
                    id: eventID,
                    description: meetingType,
                    start: thisStartDate,
                    end: thisStartDate,
                    created: createdDate,				
                    borderColor: '#fff',
                    textEscape: false,
                    url: URL
                });			
        } 
    }
    
    function setEndingSoonItems()
    {
        var itemsArray = curSource[4];
        itemsArray = itemsArray.filter(item => item.end);

        itemsArray.sort(function(a, b){
        var c = Date.parse(a.end);
        var d = Date.parse(b.end);
        return c-d;
        });

        var endingSoonStringBuilder = "";
        var endingSoonStringBuilderModal = "";

        //var endingSoonCount = 0;
        var todayPromosEnding = new Date();
        todayPromosEnding.setHours(0,0,0,0);
        var nextSevenDays = new Date();
        nextSevenDays.setHours(0,0,0,0);
        nextSevenDays = addDays(todayPromosEnding, 7);

        for (i=0;i<itemsArray.length;i++)
        {
            var item = itemsArray[i];
            var createDate = item.created;
            var launchDate = item.launchdate;		
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var trainingDate = item.training;
            var merchandisingDate = item.merchandising;
            var isDark = item.isdark;
            var meetingType = item.description;
            var extended = item.extended;
            var managingChannel = item.managingchannel;
            var launchType= item.launchtype;
            var priority = item.orderfield;
            if (meetingType == "Calendar")
            {
                // add "promo end launches"
                if (promoEndDate != "")
                {
                    if (isDark=='No' && compareDates(promoEndDate,todayPromosEnding,nextSevenDays)){
                        if(endingSoonCount == 0){
                            endingSoonStringBuilder = "<ul class='shortul-dc'>";
                        }
                        if(endingSoonCount < 4){
                            endingSoonStringBuilder = endingSoonStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        }
                        endingSoonCount++;
                    }
                }
            }
        }
        
        if(endingSoonCount > 0) 
        {
            if(endingSoonCount > 4){
                var difference = endingSoonCount - 4;
                endingSoonStringBuilder = endingSoonStringBuilder + "<a class='fc-more' id='modal-link'> +" + difference + " more</li>";
            }
            endingSoonStringBuilder = endingSoonStringBuilder + "</u>"
            $("#endingsoon")[0].innerHTML = endingSoonStringBuilder;
        }
        else
        {
            endingSoonStringBuilder = "";
            endingSoonStringBuilder = endingSoonStringBuilder + "<div class='no-new-font-dc'>No Ending Soon</div>";
            exteendingSoonStringBuilder = endingSoonStringBuilder + "</u>"
            $("#endingsoon")[0].innerHTML = endingSoonStringBuilder;		
        }
        
        var endingSoonStringBuilderP1 = "";
        var endingSoonStringBuilderP2 = "";
        var endingSoonStringBuilderP3 = "";
        var endingSoonStringBuilderP4 = "";

        var endingSoonCountP1 = 0;
        var endingSoonCountP2 = 0;
        var endingSoonCountP3 = 0;
        var endingSoonCountP4 = 0;

        var modaltitle = "<div>" + daysArray[day] + ", " + reformatDateNew(today)+"</div>"
        $("#modaltitle")[0].innerHTML = modaltitle;

        var orderedItemsArray = curSource[4];
        for (i=0;i<orderedItemsArray.length;i++)
        {
            var item = orderedItemsArray[i];
            var createDate = item.created;
            var launchDate = item.launchdate;		
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var trainingDate = item.training;
            var merchandisingDate = item.merchandising;
            var isDark = item.isdark;
            var meetingType = item.description;
            var extended = item.extended;
            var managingChannel = item.managingchannel;
            var launchType= item.launchtype;
            var priority = item.orderfield;
            if (meetingType == "Calendar")
            {
                // add "promo end launches"
                if (promoEndDate != "")
                {
                    if (isDark=='No' && compareDates(promoEndDate,todayPromosEnding,nextSevenDays)){
                        if(endingSoonCount == 0){
                            endingSoonStringBuilderP1 = "<ul class='shortul-dc'>";
                            endingSoonStringBuilderP2 = "<ul class='shortul-dc'>";
                            endingSoonStringBuilderP3 = "<ul class='shortul-dc'>";
                            endingSoonStringBuilderP4 = "<ul class='shortul-dc'>";
                        }
                        
                        if(priority == 1){
                            endingSoonStringBuilderP1 = endingSoonStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            endingSoonCountP1++;
                        } else if (priority == 2){
                            endingSoonStringBuilderP2 = endingSoonStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            endingSoonCountP2++;
                        } else if (priority == 3){
                            endingSoonStringBuilderP3 = endingSoonStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            endingSoonCountP3++;
                        } else if (priority == 4){
                            endingSoonStringBuilderP4 = endingSoonStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            endingSoonCountP4++;
                        }
                    }
                }
            }
        }

        if(endingSoonCountP1 > 0) 
        {
            endingSoonStringBuilderP1 = endingSoonStringBuilderP1 + "</u>"
            $("#modal-p1")[0].innerHTML = endingSoonStringBuilderP1;
        } else {
            endingSoonStringBuilderP1 = "";
            endingSoonStringBuilderP1 = endingSoonStringBuilderP1 + "<div class='no-new-font-dc'>No Priority 1 promotions or launches</div>";
            $("#modal-p1")[0].innerHTML = endingSoonStringBuilderP1;
        }
        if(endingSoonCountP2 > 0) 
        {
            endingSoonStringBuilderP2 = endingSoonStringBuilderP2 + "</u>"
            $("#modal-p2")[0].innerHTML = endingSoonStringBuilderP2;
        }  else {
            endingSoonStringBuilderP2 = "";
            endingSoonStringBuilderP2 = endingSoonStringBuilderP2 + "<div class='no-new-font-dc'>No Priority 2 promotions or launches</div>";
            $("#modal-p2")[0].innerHTML = endingSoonStringBuilderP2;
        }

        if(endingSoonCountP3 > 0) 
        {
            endingSoonStringBuilderP3 = endingSoonStringBuilderP3 + "</u>"
            $("#modal-p3")[0].innerHTML = endingSoonStringBuilderP3;
        }
         else {
            endingSoonStringBuilderP3 = "";
            endingSoonStringBuilderP3 = endingSoonStringBuilderP3 + "<div class='no-new-font-dc'>No Priority 3 promotions or launches</div>";
            $("#modal-p3")[0].innerHTML = endingSoonStringBuilderP3;
        }
        if(endingSoonCountP4 > 0) 
        {
            endingSoonStringBuilderP4 = endingSoonStringBuilderP4 + "</u>"
            $("#modal-p4")[0].innerHTML = endingSoonStringBuilderP4;
        }
         else {
            endingSoonStringBuilderP4 = "";
            endingSoonStringBuilderP4 = endingSoonStringBuilderP4 + "<div class='no-new-font-dc'>No Priority 4 promotions or launches</div>";
            $("#modal-p4")[0].innerHTML = endingSoonStringBuilderP4;
        }

    }

    function setCalendarItems()
    {
        var newStringBuilder = "";
        var changedStringBuilder = "";
        var darkStringBuilder = "";
        //var endingSoonStringBuilder = ""
        var launchStringBuilder = "";
        var promoStringBuilder = "";
        var extendedStringBuilder = "";
        //var newCount = 0;
        //var changeCount = 0;
        var darkCount = 0;
        var launchCount = 0;
        var promoCount = 0;
        //var extendedCount = 0;
        var endingSoonCount = 0;
        var launchesCount = [];
        var promosWaagCount = [];
        var promosCount = [];
        var trainingsCount = [];
        var merchandisingsCount = [];

        //alert ("cursource 0  length:" + curSource[4].length);
        for (i=0;i<curSource[4].length;i++)
        {
            var item = curSource[4][i];
            var createDate = item.created;
            var launchDate = item.launchdate;		
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var trainingDate = item.training;
            var merchandisingDate = item.merchandising;
            var isDark = item.isdark;
            var meetingType = item.description;
            var extended = item.extended;
            var managingChannel = item.managingchannel;
            var launchType= item.launchtype;
            var priority = item.orderfield;
            var status = item.gtmstatus;
            // add "New calendar items"
            // add "modified calendar items"
            if (meetingType == "Calendar")
            {
                if (isDark=='No' && (launchDate == 'TBD' ||  compareDates(launchDate,today,lastDay))  &&  compare4Days(createDate,today,today)) // && compareDates(launchDate,today,lastDay))
                {
                
                    if(!isFieldDM && !isGM )
                    {
                        if (newCount==0)
                            newStringBuilder = "<ul class='shortul-dc'>";
                        
                        if (newCount < 4){
                            if(promoEndDate.length == 0)
                                newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                            else 
                                newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        }
                        newCount++;

                    }
                    else if (isFieldDM)
                    {
                        if (compareDates(launchDate,today,DMLastDay))
                        {
                            if (newCount==0)
                                newStringBuilder = "<ul class='shortul-dc'>";
                            
                            if (newCount < 4){
                                if(promoEndDate.length == 0)
                                    newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            }
                            newCount++;
                        }
                    }
                    else if (isGM)
                    {
                        if (compareDates(launchDate,today,GMLastDay))
                        {
                            if (newCount==0)
                                newStringBuilder = "<ul class='shortul-dc'>";
                            
                            if (newCount < 4){
                                if(promoEndDate.length == 0)
                                    newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilder = newStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            }    
                            newCount++;
                        }
                    }								
                }
                if (isDark=='No' && compare4Days(launchDateModified,today,today) && createDate != launchDateModified)
                {
                    if(!isFieldDM && !isGM)
                    {
                        if (changeCount==0)
                            changedStringBuilder = "<ul class='shortul-dc'>";

                        if (changeCount < 4){
                            if (launchDate != 'TBD' && promoEndDate.length == 0){
                                changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                            } 
                            else if (launchDate != 'TBD' && promoEndDate.length > 0){
                                changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                            } 
                            else{
                                changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                        }
                        changeCount++;
                    }
                    else if (isFieldDM)
                    {
                        if (compareDates(launchDate,today,lastDay))
                        {					
                            if (changeCount==0)
                                changedStringBuilder = "<ul class='shortul-dc'>";

                            if (changeCount < 4){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            changeCount++;
                        }
                    }
                    else if (isGM)
                    {
                        if (compareDates(launchDate,today,GMLastDay))
                        {					
                            if (changeCount==0)
                                changedStringBuilder = "<ul class='shortul-dc'>";
                            
                            if (changeCount < 4){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    changedStringBuilder = changedStringBuilder + "<li class='dc dc-li'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            changeCount++;
                        }
                    }
                }
                // check for promo extended - ONLY for GTM - use Promo End Date Modified Date now
                if (isDark=='No' && extended == 'Yes' && managingChannel == 'GTM' && launchType == 'Promotion')
                {

                if(!isFieldDM && !isGM){
                    if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                    {				
                        if (extendedCount==0)
                            extendedStringBuilder = "<ul id='extendedString' class='shortul-dc'>";
                        
                        if (extendedCount < 4)
                            extendedStringBuilder = extendedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</span></li>";
                        
                        extendedCount++;
                    }
                } else if (isFieldDM) {
                    if (compareDates(promoEndDate,today,lastDay)){
                         if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                         {				
                            if (extendedCount==0)
                                extendedStringBuilder = "<ul id='extendedString' class='shortul-dc'>";
                            
                            if (extendedCount < 4)
                                extendedStringBuilder = extendedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</span></li>";
                            
                            extendedCount++;
                        }
                    }
                } else if (isGM) {
                    if (compareDates(promoEndDate,today,GMLastDay)){
                         if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                         {				
                            if (extendedCount==0)
                                extendedStringBuilder = "<ul id='extendedString' class='shortul-dc'>";
                                
                            if (extendedCount < 4)
                                extendedStringBuilder = extendedStringBuilder + "<li class='dc dc-li'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</span></li>";
                            
                            extendedCount++;
                         }
                    }
                }
            }
                // add "Dark calendar items"
                if (isDark=='Yes')  // && compareDates(launchDate,monday,friday)) - do not restrict dark to this week's range
                {
                    // 03/31/2021 - make sure Launch Date is today or in the future
                    if (compareDates(launchDate,today,lastDay))
                    {			
                        if (darkCount==0)
                            darkStringBuilder = "<ul class='shortul-dc'>";
                        darkStringBuilder = darkStringBuilder + "<li class='dc dc-li'>" + item.title + " - " + reformatDate(new Date(launchDate)) + "</li>";
                        darkCount++;
                    }
                }
                
                // add "current launches" - this needs to be added to the corresponding bucket
                if (isDark=='No' && compareDates(launchDate,today,addDays(today,7)) && (status == "Assigned"))
                {
                    var day = new Date(launchDate).getDay();

                    if(item.launchtype != "Promotion"){
                        if(compareDates(launchDate,addDays(today,1),addDays(today,1)))
                            launchArray[0].push(item);
                        if(compareDates(launchDate,addDays(today,2),addDays(today,2)))
                            launchArray[1].push(item);
                        if(compareDates(launchDate,addDays(today,3),addDays(today,3)))
                            launchArray[2].push(item);
                        if(compareDates(launchDate,addDays(today,4),addDays(today,4)))
                            launchArray[3].push(item); 
                        if(compareDates(launchDate,addDays(today,5),addDays(today,5)))
                            launchArray[4].push(item);        
                        if(compareDates(launchDate,addDays(today,6),addDays(today,6)))
                            launchArray[5].push(item); 
                        if(compareDates(launchDate,addDays(today,7),addDays(today,7)))
                            launchArray[6].push(item);      
                        if(day == today.getDay() && compareDates(launchDate, today, today))
                            launchArray[7].push(item);

                    } else {
                        if(compareDates(launchDate,addDays(today,1),addDays(today,1)))
                            promoArrayWaag[0].push(item);
                        if(compareDates(launchDate,addDays(today,2),addDays(today,2)))
                            promoArrayWaag[1].push(item);
                        if(compareDates(launchDate,addDays(today,3),addDays(today,3)))
                            promoArrayWaag[2].push(item);
                        if(compareDates(launchDate,addDays(today,4),addDays(today,4)))
                            promoArrayWaag[3].push(item); 
                        if(compareDates(launchDate,addDays(today,5),addDays(today,5)))
                            promoArrayWaag[4].push(item);        
                        if(compareDates(launchDate,addDays(today,6),addDays(today,6)))
                            promoArrayWaag[5].push(item); 
                        if(compareDates(launchDate,addDays(today,7),addDays(today,7)))
                            promoArrayWaag[6].push(item);  
                        if(day === today.getDay() && compareDates(launchDate, today, today))
                            promoArrayWaag[7].push(item);
                    }
                }
            }
            else
            {
                if (trainingDate != "")
                {
                    if (isDark=='No' && compareDates(trainingDate,sunday,saturday))
                    {
                        var day = new Date(trainingDate).getDay();
                        trainingArray[day].push(item);
                    }
                }
                if (merchandisingDate != "")
                {
                    if (isDark=='No' && compareDates(merchandisingDate ,sunday,saturday))
                    {
                        var day = new Date(merchandisingDate ).getDay();
                        merchandisingArray[day].push(item);
                    }
                }
            }
        }
       
        if (newCount > 0)
        {

            if (newCount > 4){
                var difference = newCount - 4;
                newStringBuilder = newStringBuilder + "<a class='fc-more' id='newLink'> +" + difference + " more</li>";
            }
            newStringBuilder = newStringBuilder + "</u>"
            $("#newview")[0].innerHTML = newStringBuilder;
        } 
        else {
            newStringBuilder = "";
            newStringBuilder = newStringBuilder + "<div class='no-new-font-dc'>No Newly Added</div>";
            newStringBuilder = newStringBuilder + "</u>"
            $("#newview")[0].innerHTML = newStringBuilder;
        }

        if (changeCount > 0)
        {
            if (changeCount > 4){
                var difference = changeCount - 4;
                changedStringBuilder = changedStringBuilder + "<a class='fc-more' id='rescheduledLink'> +" + difference + " more</li>";
            }
            changedStringBuilder = changedStringBuilder + "</u>"
            $("#launchdatechanges")[0].innerHTML = changedStringBuilder;
        }
        else {
            changedStringBuilder = "";
            changedStringBuilder = changedStringBuilder + "<div class='no-new-font-dc'>No Rescheduled</div>";
            changedStringBuilder = changedStringBuilder + "</u>"
            $("#launchdatechanges")[0].innerHTML = changedStringBuilder;
        }

        if (extendedCount > 0)
        {
        
            if(extendedCount > 4){
                var difference = extendedCount - 4;
                extendedStringBuilder = extendedStringBuilder + "<a class='fc-more' id='extendedLink'> +" + difference + " more</li>";
            }

            extendedStringBuilder = extendedStringBuilder + "</u>"
            $("#promoextended")[0].innerHTML = extendedStringBuilder;		
            //sortList("extendedString");  // do this to sort extended promo alphabetically
        
        }
        else
        {
            extendedStringBuilder = "";
            extendedStringBuilder = extendedStringBuilder + "<div class='no-new-font-dc'>No Extensions</div>";
            extendedStringBuilder = extendedStringBuilder + "</u>"
            $("#promoextended")[0].innerHTML = extendedStringBuilder;		
        }
    
        if(endingSoonCount > 0) 
        {
            endingSoonStringBuilder = endingSoonStringBuilder + "</u>"
            $("#endingsoon")[0].innerHTML = endingSoonStringBuilder;
        }
        

        if (darkCount > 0)
        {
            darkStringBuilder = darkStringBuilder + "</u>"
            //$("#executiveview")[0].innerHTML = darkStringBuilder;
        }


        var newStringBuilderP1 = "";
        var newStringBuilderP2 = "";
        var newStringBuilderP3 = "";
        var newStringBuilderP4 = "";

        var newCountP1 = 0;
        var newCountP2 = 0;
        var newCountP3 = 0;
        var newCountP4 = 0;

        var extendedStringBuilderP1 = "";
        var extendedStringBuilderP2 = "";
        var extendedStringBuilderP3 = "";
        var extendedStringBuilderP4 = "";

        var extendedCountP1 = 0;
        var extendedCountP2 = 0;
        var extendedCountP3 = 0;
        var extendedCountP4 = 0;

        var rescheduledStringBuilderP1 = "";
        var rescheduledStringBuilderP2 = "";
        var rescheduledStringBuilderP3 = "";
        var rescheduledStringBuilderP4 = "";

        var rescheduledCountP1 = 0;
        var rescheduledCountP2 = 0;
        var rescheduledCountP3 = 0;
        var rescheduledCountP4 = 0;

        var modaltitle = "<div>" + daysArray[day] + ", " + reformatDateNew(today)+"</div>"
        $("#modaltitle")[0].innerHTML = modaltitle;

        var orderedItemsArray = curSource[4];
        for (i=0;i<orderedItemsArray.length;i++)
        {
            var item = orderedItemsArray[i];
            var createDate = item.created;
            var launchDate = item.launchdate;		
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var trainingDate = item.training;
            var merchandisingDate = item.merchandising;
            var isDark = item.isdark;
            var meetingType = item.description;
            var extended = item.extended;
            var managingChannel = item.managingchannel;
            var launchType= item.launchtype;
            var priority = item.orderfield;
            if (meetingType == "Calendar")
            {

                if (isDark=='No' && (launchDate == 'TBD' ||  compareDates(launchDate,today,lastDay))  &&  compare4Days(createDate,today,today)) // && compareDates(launchDate,today,lastDay))
                {
                
                    if(!isFieldDM && !isGM )
                    {
                        if (newCount==0){
                            newStringBuilderP1 = "<ul class='shortul-dc'>";
                            newStringBuilderP2 = "<ul class='shortul-dc'>";
                            newStringBuilderP3 = "<ul class='shortul-dc'>";
                            newStringBuilderP4 = "<ul class='shortul-dc'>";
                        } 

                        if (priority == 1){
                            if(promoEndDate.length == 0)
                                newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                            else 
                                newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        
                            newCountP1++;
                        }
                        else if (priority == 2){
                            if(promoEndDate.length == 0)
                                newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                            else 
                                newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        
                            newCountP2++;
                        }
                        else if (priority == 3){
                            if(promoEndDate.length == 0)
                                newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                            else 
                                newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        
                            newCountP3++;
                        }
                        else if (priority == 4){
                            if(promoEndDate.length == 0)
                                newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                            else 
                                newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                        
                            newCountP4++;
                        }

                    }
                    else if (isFieldDM)
                    {
                        if (compareDates(launchDate,today,DMLastDay))
                        {
                            if (newCount==0){
                                newStringBuilderP1 = "<ul class='shortul-dc'>";
                                newStringBuilderP2 = "<ul class='shortul-dc'>";
                                newStringBuilderP3 = "<ul class='shortul-dc'>";
                                newStringBuilderP4 = "<ul class='shortul-dc'>";
                            } 

                            if (priority == 1){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP1++;
                            }
                            else if (priority == 2){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP2++;
                            }
                            else if (priority == 3){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP3++;
                            }
                            else if (priority == 4){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP4++;
                            }
                        }
                    }
                    else if (isGM)
                    {
                        if (compareDates(launchDate,today,GMLastDay))
                        {
                            if (newCount==0){
                                newStringBuilderP1 = "<ul class='shortul-dc'>";
                                newStringBuilderP2 = "<ul class='shortul-dc'>";
                                newStringBuilderP3 = "<ul class='shortul-dc'>";
                                newStringBuilderP4 = "<ul class='shortul-dc'>";
                            } 

                            if (priority == 1){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP1 = newStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP1++;
                            } 
                            else if (priority == 2){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP2 = newStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP2++;
                            }    
                            else if (priority == 3){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP3 = newStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP3++;
                            }  
                            else if (priority == 4){
                                if(promoEndDate.length == 0)
                                    newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "</li>";
                                else 
                                    newStringBuilderP4 = newStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                
                                newCountP4++;
                            }    
                        }
                    }								
                }
            
                if (isDark=='No' && compare4Days(launchDateModified,today,today) && createDate != launchDateModified)
                {
                    if(!isFieldDM && !isGM)
                    {
                        if (changeCount==0){
                            rescheduledStringBuilderP1 = "<ul class='shortul-dc'>";
                            rescheduledStringBuilderP2 = "<ul class='shortul-dc'>";
                            rescheduledStringBuilderP3 = "<ul class='shortul-dc'>";
                            rescheduledStringBuilderP4 = "<ul class='shortul-dc'>";
                        } 

                        if(priority == 1){
                            if (launchDate != 'TBD' && promoEndDate.length == 0){
                                rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                            } 
                            else if (launchDate != 'TBD' && promoEndDate.length > 0){
                                rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                            } 
                            else{
                                rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            rescheduledCountP1++;
                        } else if (priority == 2){
                             if (launchDate != 'TBD' && promoEndDate.length == 0){
                                rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                            } 
                            else if (launchDate != 'TBD' && promoEndDate.length > 0){
                                rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                            } 
                            else{
                                rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            rescheduledCountP2++;
                        } else if (priority == 3){
                            if (launchDate != 'TBD' && promoEndDate.length == 0){
                                rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                            } 
                            else if (launchDate != 'TBD' && promoEndDate.length > 0){
                                rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                            } 
                            else{
                                rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            rescheduledCountP3++;
                        } else if (priority == 4){
                             if (launchDate != 'TBD' && promoEndDate.length == 0){
                                rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                            } 
                            else if (launchDate != 'TBD' && promoEndDate.length > 0){
                                rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                            } 
                            else{
                                rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            }
                            rescheduledCountP4++;
                        }      
                    }
                    else if (isFieldDM)
                    {
                        if (compareDates(launchDate,today,lastDay))
                        {					
                            if (changeCount==0){
                                rescheduledStringBuilderP1 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP2 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP3 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP4 = "<ul class='shortul-dc'>";
                            } 

                            
                            if(priority == 1){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP1++;
                            }
                            else if(priority == 2){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP2++;
                            }
                            else if(priority == 3){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP3++;
                            }
                            else if(priority == 4){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP4++;
                            }
                        }
                    }
                    else if (isGM)
                    {
                        if (compareDates(launchDate,today,GMLastDay))
                        {					
                           if (changeCount==0){
                                rescheduledStringBuilderP1 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP2 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP3 = "<ul class='shortul-dc'>";
                                rescheduledStringBuilderP4 = "<ul class='shortul-dc'>";
                            } 

                            if (priority == 1){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP1++;
                            }
                            else if (priority == 2){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP2++;
                            }
                            else if (priority == 3){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP3++;
                            }
                            else if (priority == 4){
                                if (launchDate != 'TBD' && promoEndDate.length == 0)
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "</span></li>";
                                else if (launchDate != 'TBD' && promoEndDate.length > 0)
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " + "<span>" + reformatDate(new Date(launchDate)) + "-" + reformatDate(promoEndDate) + "</span></li>";
                                else
                                    rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title +  " (P" + priority + ")" + " — " + "<span>" + launchDate + "</span></li>";
                            
                                rescheduledCountP4++;
                            }
                        }
                    }
                }
                if (isDark=='No' && extended == 'Yes' && managingChannel == 'GTM' && launchType == 'Promotion')
                {

                if(!isFieldDM && !isGM){
                    if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                    {				
                        if (extendedCount==0){
                            extendedStringBuilderP1 = "<ul class='shortul-dc'>";
                            extendedStringBuilderP2 = "<ul class='shortul-dc'>";
                            extendedStringBuilderP3 = "<ul class='shortul-dc'>";
                            extendedStringBuilderP4 = "<ul class='shortul-dc'>";
                        } 
                        
                        if(priority == 1){
                            extendedStringBuilderP1 = extendedStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            extendedCountP1++;
                        } else if (priority == 2){
                            extendedStringBuilderP2 = extendedStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            extendedCountP2++;
                        } else if (priority == 3){
                            extendedStringBuilderP3 = extendedStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            extendedCountP3++;
                        } else if (priority == 4){
                            extendedStringBuilderP4 = extendedStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                            extendedCountP4++;
                        }                       
            
                    }
                } else if (isFieldDM) {
                    if (compareDates(promoEndDate,today,lastDay)){
                         if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                         {				
                            if (extendedCount==0){
                                extendedStringBuilderP1 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP2 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP3 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP4 = "<ul class='shortul-dc'>";
                            } 
                             if(priority == 1){
                                extendedStringBuilderP1 = extendedStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP1++;
                            } else if (priority == 2){
                                extendedStringBuilderP2 = extendedStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP2++;
                            } else if (priority == 3){
                                extendedStringBuilderP3 = extendedStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP3++;
                            } else if (priority == 4){
                                extendedStringBuilderP4 = extendedStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP4++;
                            }                       
                        }
                    }
                } else if (isGM) {
                    if (compareDates(promoEndDate,today,GMLastDay)){
                        if (compare4Days(promoDateModified,today,today)) // 02/26/20 DO NOT COMPARE LAUNCH DATES SINCE WE HAVE SOME VERY OLD BRIEFS THAT WERE EXTENDED RECENTLY
                        {				
                            if (extendedCount==0){
                                extendedStringBuilderP1 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP2 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP3 = "<ul class='shortul-dc'>";
                                extendedStringBuilderP4 = "<ul class='shortul-dc'>";
                            }

                            if(priority == 1){
                                extendedStringBuilderP1 = extendedStringBuilderP1 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP1++;
                            } else if (priority == 2){
                                extendedStringBuilderP2 = extendedStringBuilderP2 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP2++;
                            } else if (priority == 3){
                                extendedStringBuilderP3 = extendedStringBuilderP3 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP3++;
                            } else if (priority == 4){
                                extendedStringBuilderP4 = extendedStringBuilderP4 + "<li class='dc-modal dc-li-modal'>" + item.title + " (P" + priority + ")" + " — " +  reformatDate(new Date(launchDate)) + "-" + reformatDate(new Date(promoEndDate)) + "</li>";
                                extendedCountP4++;
                            }                       
            
                        }
                    }
                }
            }

            }
        }

        if(newCountP1 > 0) 
        {
            newStringBuilderP1 = newStringBuilderP1 + "</u>"
            $("#newmodal-p1")[0].innerHTML = newStringBuilderP1;
        } else {
            newStringBuilderP1 = "";
            newStringBuilderP1 = newStringBuilderP1 + "<div class='no-new-font-dc'>No Priority 1 promotions or launches</div>";
            $("#newmodal-p1")[0].innerHTML = newStringBuilderP1;
        }
        if(newCountP2 > 0) 
        {
           newStringBuilderP2 = newStringBuilderP2 + "</u>"
            $("#newmodal-p2")[0].innerHTML = newStringBuilderP2;
        }  else {
            newStringBuilderP2 = "";
            newStringBuilderP2 = newStringBuilderP2 + "<div class='no-new-font-dc'>No Priority 2 promotions or launches</div>";
            $("#newmodal-p2")[0].innerHTML = newStringBuilderP2;
        }

        if(newCountP3 > 0) 
        {
           
            newStringBuilderP3 = newStringBuilderP3 + "</u>"
            $("#newmodal-p3")[0].innerHTML = newStringBuilderP3;
        }
         else {
            newStringBuilderP3 = "";
            newStringBuilderP3 = newStringBuilderP3 + "<div class='no-new-font-dc'>No Priority 3 promotions or launches</div>";
            $("#newmodal-p3")[0].innerHTML = newStringBuilderP3;
        }
        if(newCountP4 > 0) 
        {
           
            newStringBuilderP4 = newStringBuilderP4 + "</u>"
            $("#newmodal-p4")[0].innerHTML = newStringBuilderP4;
        }
         else {
            newStringBuilderP4 = "";
            newStringBuilderP4 = newStringBuilderP4 + "<div class='no-new-font-dc'>No Priority 4 promotions or launches</div>";
            $("#newmodal-p4")[0].innerHTML = newStringBuilderP4;
        }
    
        if(rescheduledCountP1 > 0) 
        {
            rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "</u>"
            $("#rescheduledmodal-p1")[0].innerHTML = rescheduledStringBuilderP1;
        } else {
            rescheduledStringBuilderP1 = "";
            rescheduledStringBuilderP1 = rescheduledStringBuilderP1 + "<div class='no-new-font-dc'>No Priority 1 promotions or launches</div>";
            $("#rescheduledmodal-p1")[0].innerHTML = rescheduledStringBuilderP1;
        }
        if(rescheduledCountP2 > 0) 
        {
           
            rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "</u>"
            $("#rescheduledmodal-p2")[0].innerHTML = rescheduledStringBuilderP2;
        }  else {
            rescheduledStringBuilderP2 = "";
            rescheduledStringBuilderP2 = rescheduledStringBuilderP2 + "<div class='no-new-font-dc'>No Priority 2 promotions or launches</div>";
            $("#rescheduledmodal-p2")[0].innerHTML = rescheduledStringBuilderP2;
        }

        if(rescheduledCountP3 > 0) 
        {
           
            rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "</u>"
            $("#rescheduledmodal-p3")[0].innerHTML = rescheduledStringBuilderP3;
        }
         else {
            rescheduledStringBuilderP3 = "";
            rescheduledStringBuilderP3 = rescheduledStringBuilderP3 + "<div class='no-new-font-dc'>No Priority 3 promotions or launches</div>";
            $("#rescheduledmodal-p3")[0].innerHTML = rescheduledStringBuilderP3;
        }
        if(rescheduledCountP4 > 0) 
        {
           
            rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "</u>"
            $("#rescheduledmodal-p4")[0].innerHTML = rescheduledStringBuilderP4;
        }
         else {
            rescheduledStringBuilderP4 = "";
            rescheduledStringBuilderP4 = rescheduledStringBuilderP4 + "<div class='no-new-font-dc'>No Priority 4 promotions or launches</div>";
            $("#rescheduledmodal-p4")[0].innerHTML = rescheduledStringBuilderP4;
        }
     
        if(extendedCountP1 > 0) 
        {
            extendedStringBuilderP1 = extendedStringBuilderP1 + "</u>"
            $("#extendedmodal-p1")[0].innerHTML = extendedStringBuilderP1;
        } else {
            extendedStringBuilderP1 = "";
            extendedStringBuilderP1 = extendedStringBuilderP1 + "<div class='no-new-font-dc'>No Priority 1 promotions or launches</div>";
            $("#extendedmodal-p1")[0].innerHTML = extendedStringBuilderP1;
        }

        if(extendedCountP2 > 0) 
        {
           
            extendedStringBuilderP2 = extendedStringBuilderP2 + "</u>"
            $("#extendedmodal-p2")[0].innerHTML = extendedStringBuilderP2;
        }  else {
            extendedStringBuilderP2 = "";
            extendedStringBuilderP2 = extendedStringBuilderP2 + "<div class='no-new-font-dc'>No Priority 2 promotions or launches</div>";
            $("#extendedmodal-p2")[0].innerHTML = extendedStringBuilderP2;
        }

        if(extendedCountP3 > 0) 
        {
           
            extendedStringBuilderP3 = extendedStringBuilderP3 + "</u>"
            $("#extendedmodal-p3")[0].innerHTML = extendedStringBuilderP3;
        }
         else {
            extendedStringBuilderP3 = "";
            extendedStringBuilderP3 = extendedStringBuilderP3 + "<div class='no-new-font-dc'>No Priority 3 promotions or launches</div>";
            $("#extendedmodal-p3")[0].innerHTML = extendedStringBuilderP3;
        }

        if(extendedCountP4 > 0) 
        {
           
            extendedStringBuilderP4 = extendedStringBuilderP4 + "</u>"
            $("#extendedmodal-p4")[0].innerHTML = extendedStringBuilderP4;
        }
        else {
            extendedStringBuilderP4 = "";
            extendedStringBuilderP4 = extendedStringBuilderP4 + "<div class='no-new-font-dc'>No Priority 4 promotions or launches</div>";
            $("#extendedmodal-p4")[0].innerHTML = extendedStringBuilderP4;
        }
        
        for (i=0;i<8;i++)
        {
            launchStringBuilder = "";
            launchCount = 0;
            if (launchArray[i].length > 0)
            {
                for (j=0;j<launchArray[i].length;j++)
                {
                    item = launchArray[i][j];
                    if (launchCount==0)
                        launchStringBuilder = "<ul class='shortul'>";
                    var dates = item.dates;
                    dates = dates.replace(/string;#/g,'');
                    dates = dates.replace(/\//g, '.');
                    var priority = item.orderfield;
                    //launchStringBuilder = launchStringBuilder + "<li>" + item.title + " - " + reformatDate(new Date(item.launchdate)) +  "</li>";
                    launchStringBuilder = launchStringBuilder + "<li>" + item.title + " (P" + priority + ")" + "</li>";
                    launchCount++;
                }
                launchesCount[i] = launchCount;
            }
            if (launchCount > 0)
            {
                launchStringBuilder = launchStringBuilder + "</u>"
                $("#launch"+i)[0].innerHTML = launchStringBuilder;
            }	

            if(launchCount == 0)
            {
                launchStringBuilder = "<div class='no-new-font'>No New Launches</div>" + "</u>"
                $("#launch"+i)[0].innerHTML = launchStringBuilder;

            }	
        }	
        
        for (i=0;i<8;i++)
        {
            launchStringBuilder = "";
            launchCount = 0;
            if (promoArrayWaag[i].length > 0)
            {
                for (j=0;j<promoArrayWaag[i].length;j++)
                {
                    item = promoArrayWaag[i][j];
                    if (launchCount==0)
                        launchStringBuilder = "<ul class='shortul'>";
                    //var dates = item.dates;
                    //dates = dates.replace(/string;#/g,'');
                    //dates = dates.replace(/\//g, '.');
                    var endDate = item.end;
                    var priority = item.orderfield;
                    //launchStringBuilder = launchStringBuilder + "<li>" + item.title + " - " + reformatDate(new Date(item.launchdate)) +  "</li>";
                    launchStringBuilder = launchStringBuilder + "<li>" + item.title + " (P" + priority + ")" + " - Expires " + reformatDate(new Date(endDate)) + "</li>";
                    launchCount++;
                    promosWaagCount[i] = launchCount;
                }
                promosWaagCount[i] = launchCount;
            }
            if (launchCount > 0)
            {
                launchStringBuilder = launchStringBuilder + "</u>"
                $("#promowaag"+i)[0].innerHTML = launchStringBuilder;
            }		

            if(launchCount == 0)
            {
                launchStringBuilder = "<div class='no-new-font'>No New Promotions</div>" + "</u>"
                $("#promowaag"+i)[0].innerHTML = launchStringBuilder;

            }
        }
    
      
        for (i=0;i<8;i++)
        {
            launchStringBuilder = "";
            launchCount = 0;
            /* task #685
            if (trainingArray[i].length > 0)
            {
                for (j=0;j<trainingArray[i].length;j++)
                {
                    item = trainingArray[i][j];
                    if (launchCount==0)
                        launchStringBuilder = "<ul class='shortul'>";
                    //var dates = item.dates;
                    //dates = dates.replace(/string;#/g,'');
                    //dates = dates.replace(/\//g, '.');
                    //launchStringBuilder = launchStringBuilder + "<li>" + item.title + " - " + dates + "</li>";
                    launchStringBuilder = launchStringBuilder + "<li>" + item.title + "</li>";
                    launchCount++;
                    launchesCount[i] = launchCount
                }
                trainingsCount[i] = launchCount;
            }*/
            if (launchCount > 0)
            {
                launchStringBuilder = launchStringBuilder + "</u>"
                //$("#training"+i)[0].innerHTML = launchStringBuilder;
            }		
        }
        
        for (i=0;i<8;i++)
        {
            launchStringBuilder = "";
            launchCount = 0;
            /* no longer needed - task #685
            if (merchandisingArray[i].length > 0)
            {
                for (j=0;j<merchandisingArray[i].length;j++)
                {
                    item = merchandisingArray[i][j];
                    if (launchCount==0)
                        launchStringBuilder = "<ul class='shortul'>";
                    //var dates = item.dates;
                    //dates = dates.replace(/string;#/g,'');
                    //dates = dates.replace(/\//g, '.');
                    launchStringBuilder = launchStringBuilder + "<li>" + item.title + "</li>";
                    launchCount++;
                    launchesCount[i] = launchCount
                }
                merchandisingsCount[i] = launchCount;
            }*/
            if (launchCount > 0)
            {
                launchStringBuilder = launchStringBuilder + "</u>"
                //$("#merchandising"+i)[0].innerHTML = launchStringBuilder;
            }		
        }	
        // override the entire day block if there's nothing for that day
        
        for (i=0;i<8;i++)
        {
            //if (typeof launchesCount[i] == "undefined")
            //    $("#day" + i)[0].innerHTML = "<span class='sectionfont'>" + daysArray[i] + " " + reformatDateHtml((daysinweek[i])) + "</span>" + "<div class='contentheaderbold' style='margin-top:10px'>No New launches</div>";
            //$("#day" + i)[0].innerHTML = "<div class='contentheaderbold' style='margin-top:10px'>No New launches</div>";
        }	
        
        //if (typeof launchesCount[i] == "undefined")
        //    $("#today)[0].innerHTML = "<span class='sectionfont'>" + reformatDateHtml(today) + " " + daysArray[day] + "</span>" + "<div class='contentheaderbold' style='margin-top:10px'>No New launches</div>";
    
        // B2B Interlock Calendars - held on Friday
        var thisweekMeetingCount = 0;
        var nextweekMeetingCount = 0;
        var thisWeekStringBuilder = "";
        var nextWeekStringBuilder = "";
        var jumpLinkStringBuilder = "";
        
        executiveMeetingCheck[7]="";
        marketingMeetingCheck[7]="";
        fieldMeetingCheck[7]="";

        // add "B2B Interlock calendar items" - 10/24/21 - B2B is now on Thursday, daysArray[4], not daysArray[5]
        
        for (i=0;i<curSource[0].length;i++)
        {
            var item = curSource[0][i];
            var launchDate = item.launchdate;	
            var meetingDate = item.start;
            var nextweekMeetingDate = addDays(new Date(meetingDate ), 7);
            var launchDateModified = item.launchdatechange;
            var promoEndDate = item.end;
            var isDark = item.isdark;
            var day = new Date(meetingDate).getDay();			
            if (compareDates(meetingDate,sunday,saturday))
            {
                if (thisweekMeetingCount==0)
                    thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                thisWeekStringBuilder = thisWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                thisweekMeetingCount++;
            }
            if (compareDates(meetingDate,nextsunday,nextsaturday))
            {
                if (nextweekMeetingCount==0)
                    nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                nextWeekStringBuilder = nextWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                nextweekMeetingCount++;
            }		
        }
        
        if (thisweekMeetingCount > 0)
        {
            thisWeekStringBuilder = thisWeekStringBuilder + "</u>"
            //$("#thisweek4")[0].innerHTML = thisWeekStringBuilder;
        }
        else
        {
            //thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[4] + " " + reformatDate(new Date(thursday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            //$("#thisweek4")[0].innerHTML = thisWeekStringBuilder;
        }	
        if (nextweekMeetingCount > 0)
        {
            nextWeekStringBuilder = nextWeekStringBuilder + "</u>"
            //$("#nextweek4")[0].innerHTML = nextWeekStringBuilder;
        }
        else
        {
            //nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[4] + " " + reformatDate(new Date(nextthursday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            //$("#nextweek4")[0].innerHTML = nextWeekStringBuilder;
        }	
        
        
    // Executive Calendars - held on Wednesday

        thisweekMeetingCount = 0;
        nextweekMeetingCount = 0;
        thisWeekStringBuilder = "";
        nextWeekStringBuilder = "";
        for (i=0;i<curSource[1].length;i++)
        {
            var item = curSource[1][i];
            var launchDate = item.launchdate;	
            var meetingDate = item.start;
            var nextweekMeetingDate = addDays(new Date(meetingDate ), 7);
            new Date(meetingDate );
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var isDark = item.isdark;
            var day = new Date(meetingDate).getDay();
            // add "CSS calendar items"
            if (compareDates(meetingDate,sunday,saturday))
            {
                if (thisweekMeetingCount==0)
                    thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                thisWeekStringBuilder = thisWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                thisweekMeetingCount++;
            }
            if (compareDates(meetingDate,nextsunday,nextsaturday))
            {
                if (nextweekMeetingCount==0)
                    nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                nextWeekStringBuilder = nextWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                nextweekMeetingCount++;
            }	

            if(compareDates(meetingDate, addDays(today,1), addDays(today,1)))
                executiveMeetingCheck[0]=true;
            if(compareDates(meetingDate, addDays(today,2), addDays(today,2)))
                executiveMeetingCheck[1]=true;
            if(compareDates(meetingDate, addDays(today,3), addDays(today,3)))
                executiveMeetingCheck[2]=true;
            if(compareDates(meetingDate, addDays(today,4), addDays(today,4)))
                executiveMeetingCheck[3]=true;
            if(compareDates(meetingDate, addDays(today,5), addDays(today,5)))
                executiveMeetingCheck[4]=true;
            if(compareDates(meetingDate, addDays(today,6), addDays(today,6)))
                executiveMeetingCheck[5]=true;
            if(compareDates(meetingDate, addDays(today,7), addDays(today,7)))
                executiveMeetingCheck[6]=true;   
            if(compareDates(meetingDate, addDays(today,0), addDays(today,0)))
                executiveMeetingCheck[7]=true;	
        }
        if (thisweekMeetingCount > 0)
        {
            thisWeekStringBuilder = thisWeekStringBuilder + "</u>"
            $("#thisweek2")[0].innerHTML = thisWeekStringBuilder;
        }
        else
        {
            thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[3] + " " + reformatDate(new Date(wednesday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#thisweek2")[0].innerHTML = thisWeekStringBuilder;
        }	
        if (nextweekMeetingCount > 0)
        {
            nextWeekStringBuilder = nextWeekStringBuilder + "</u>"
            $("#nextweek2")[0].innerHTML = nextWeekStringBuilder;
        }
        else
        {
            nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[3] + " " + reformatDate(new Date(nextwednesday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#nextweek2")[0].innerHTML = nextWeekStringBuilder;
        }

    // Interlock Calendars - held on Monday
        thisweekMeetingCount = 0;
        nextweekMeetingCount = 0;
        thisWeekStringBuilder = "";
        nextWeekStringBuilder = "";
        for (i=0;i<curSource[2].length;i++)
        {
            var item = curSource[2][i];
            var launchDate = item.launchdate;	
            var meetingDate = item.start;
            var nextweekMeetingDate = addDays(new Date(meetingDate ), 7);
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var isDark = item.isdark;
            var day = new Date(meetingDate).getDay();
            // add "CSS calendar items"
            if (compareDates(meetingDate,sunday,saturday))
            {
                if (thisweekMeetingCount==0)
                    thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                thisWeekStringBuilder = thisWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                thisweekMeetingCount++;
            }
            if (compareDates(meetingDate,nextsunday,nextsaturday))
            {
                if (nextweekMeetingCount==0)
                    nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                nextWeekStringBuilder = nextWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                nextweekMeetingCount++;
            }	

            //marketingMeetingCheck.push([]);

            if(compareDates(meetingDate, addDays(today,1), addDays(today,1)))
                marketingMeetingCheck[0]=true;
            if(compareDates(meetingDate, addDays(today,2), addDays(today,2)))
                marketingMeetingCheck[1]=true;
            if(compareDates(meetingDate, addDays(today,3), addDays(today,3)))
                marketingMeetingCheck[2]=true;
            if(compareDates(meetingDate, addDays(today,4), addDays(today,4)))
                marketingMeetingCheck[3]=true;
            if(compareDates(meetingDate, addDays(today,5), addDays(today,5)))
                marketingMeetingCheck[4]=true;
            if(compareDates(meetingDate, addDays(today,6), addDays(today,6)))
                marketingMeetingCheck[5]=true;
            if(compareDates(meetingDate, addDays(today,7), addDays(today,7)))
                marketingMeetingCheck[6]=true;
            if(compareDates(meetingDate, addDays(today,0), addDays(today,0)))
                marketingMeetingCheck[7]=true;
        }
        if (thisweekMeetingCount > 0)
        {
            thisWeekStringBuilder = thisWeekStringBuilder + "</u>"
            $("#thisweek0")[0].innerHTML = thisWeekStringBuilder;
        }
        else
        {
            thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[1] + " " + reformatDate(new Date(monday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#thisweek0")[0].innerHTML = thisWeekStringBuilder;
        }	
        if (nextweekMeetingCount > 0)
        {
            nextWeekStringBuilder = nextWeekStringBuilder + "</u>"
            $("#nextweek0")[0].innerHTML = nextWeekStringBuilder;
        }
        else
        {
            nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[1] + " " + reformatDate(new Date(nextmonday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#nextweek0")[0].innerHTML = nextWeekStringBuilder;
        }	
        //Field Leadership calendar - held on Thursday
        thisweekMeetingCount = 0;
        nextweekMeetingCount = 0;
        thisWeekStringBuilder = "";
        nextWeekStringBuilder = "";
        for (i=0;i<curSource[3].length;i++)
        {
            var item = curSource[3][i];
            var launchDate = item.launchdate;	
            var meetingDate = item.start;
            var nextweekMeetingDate = addDays(new Date(meetingDate ), 7);
            var launchDateModified = item.launchdatechange;
            var promoDateModified = item.promodatechange;
            var promoEndDate = item.end;
            var isDark = item.isdark;
            var day = new Date(meetingDate).getDay();
            // add "calendar items"
            if (compareDates(meetingDate,sunday,saturday))
            {
                if (thisweekMeetingCount==0)
                    thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                thisWeekStringBuilder = thisWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                thisweekMeetingCount++;
            }
            if (compareDates(meetingDate,nextsunday,nextsaturday))
            {
                if (nextweekMeetingCount==0)
                    nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[day] + " " + reformatDate(new Date(meetingDate)) + "</span><br>" + "<ul class='shortul-meetings'>";
                nextWeekStringBuilder = nextWeekStringBuilder + "<li class='meeting-li dc-li-meeting'>" + item.title + "</li>";
                nextweekMeetingCount++;
            }	
        
            if(compareDates(meetingDate, addDays(today,1), addDays(today,1)))
                fieldMeetingCheck[0]=true;
            if(compareDates(meetingDate, addDays(today,2), addDays(today,2)))
                fieldMeetingCheck[1]=true;
            if(compareDates(meetingDate, addDays(today,3), addDays(today,3)))
                fieldMeetingCheck[2]=true;
            if(compareDates(meetingDate, addDays(today,4), addDays(today,4)))
                fieldMeetingCheck[3]=true;
            if(compareDates(meetingDate, addDays(today,5), addDays(today,5)))
                fieldMeetingCheck[4]=true;
            if(compareDates(meetingDate, addDays(today,6), addDays(today,6)))
                fieldMeetingCheck[5]=true;
            if(compareDates(meetingDate, addDays(today,7), addDays(today,7)))
                fieldMeetingCheck[6]=true;
            if(compareDates(meetingDate, addDays(today,0), addDays(today,0)))
                fieldMeetingCheck[7]=true;
        }
        if (thisweekMeetingCount > 0)
        {
            thisWeekStringBuilder = thisWeekStringBuilder + "</u>"
            $("#thisweek3")[0].innerHTML = thisWeekStringBuilder;
            
        }
        else {
            thisWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[4] + " " + reformatDate(new Date(thursday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#thisweek3")[0].innerHTML = thisWeekStringBuilder;

        }	
        if (nextweekMeetingCount > 0)
        {
            nextWeekStringBuilder = nextWeekStringBuilder + "</u>"
            $("#nextweek3")[0].innerHTML = nextWeekStringBuilder;
        }
        else
        {
            nextWeekStringBuilder = "<span class='day-meeting-title'>" + daysArray[4] + " " + reformatDate(new Date(nextthursday)) + "</span><br>" + "<div class='no-meeting-font shortul-meeting'>No Scheduled Meeting</div>";	
            $("#nextweek3")[0].innerHTML = nextWeekStringBuilder;
        }


        var noMeetingStringBuilder = "<div class='no-new-font'>No Meetings</div>";
        for(var i = 0; i<8; i++){    
            var jumpLinkButtonStringBuilder = "";
            //noMeetingStringBuilder = "<div class='no-new-font'>No Meetings</div>"

            if(i<8){
                //noMeetingStringBuilder = "";
                if((marketingMeetingCheck[i] == undefined || marketingMeetingCheck[i] == "") && 
                    (executiveMeetingCheck[i] == undefined || executiveMeetingCheck[i] == "") && 
                    (fieldMeetingCheck[i] == undefined || fieldMeetingCheck[i] == "")){
                    $("#meeting" + i)[0].innerHTML = noMeetingStringBuilder;                   
                } else {
                    
                    jumpLinkButtonStringBuilder = "";
                    if(marketingMeetingCheck[i] == true && (isInterlock || isGTM)){
                        jumpLinkButtonStringBuilder = "<span><a href='#meeting-anchor'><button type='button' class='jumplink-button jumplink-font'>";
                        jumpLinkButtonStringBuilder = jumpLinkButtonStringBuilder + "Marketing Interlock</button></a></span></u>";
                    }
                    
                    if(executiveMeetingCheck[i] == true && (isInterlock || isVPandDirector || isGTM)){
                        jumpLinkButtonStringBuilder = jumpLinkButtonStringBuilder + "<span><a href='#meeting-anchor'><button type='button' class='jumplink-button jumplink-font'>";
                        jumpLinkButtonStringBuilder = jumpLinkButtonStringBuilder + "Executive GTM Briefing</button></a></span></u>";
                    }
                    
                    if(fieldMeetingCheck[i] == true && (isInterlock || isCalendar || isFieldDM || isGTM || isVPandDirector)){
                        jumpLinkButtonStringBuilder = jumpLinkButtonStringBuilder + "<span><a href='#meeting-anchor'><button type='button' class='jumplink-button jumplink-font' style='width:200px'>";
                        jumpLinkButtonStringBuilder = jumpLinkButtonStringBuilder + "Field Leadership GTM Briefing</button></a></span></u>";
                    }
                    if(jumpLinkButtonStringBuilder.length > 0)
                        $("#meeting" + i)[0].innerHTML = jumpLinkButtonStringBuilder;
                    else 
                        $("#meeting" + i)[0].innerHTML = noMeetingStringBuilder;                   

                }
                
                //Use ids to hide jump links once added
            }
        }
    }
    
    function isEven(n) {
       return n % 2 == 0;
    }
    
    function compare7Days (currentDate, startDate, endDate)
    {
        var timestamp=Date.parse(currentDate);
    
        if (isNaN(timestamp)==false)
        {
        //LL - this logic is added to compare the date with itself (minus 7 days), not the Monday-Friday limitation
        //LL - set hours to 0 so that we're only comparing on date, not time
            var days = -7;
            var start = addDays(today, days);
            var end = addDays(today, 7);
            //currentDate.setHours(0,0,0,0);
            //start.setHours(0,0,0,0);
            //end.setHours(0,0,0,0);
            currentDate = new Date(currentDate);
            if (currentDate >= start && currentDate <= end) 
            {
                return true;
            }
            else return false;
        }
    }
    
    function compare4Days (currentDate, startDate, endDate)
    {
        //03/16/21 - change from -4 to -5 to match DD
        var timestamp=Date.parse(currentDate);
    
        if (isNaN(timestamp)==false)
        {
        //LL - this logic is added to compare the date with itself (minus 7 days), not the Monday-Friday limitation
        //LL - set hours to 0 so that we're only comparing on date, not time
            var days = -5;
            var start = addDays(today, days);
            var end = addDays(today, 7);
            //currentDate.setHours(0,0,0,0);
            //start.setHours(0,0,0,0);
            //end.setHours(0,0,0,0);
            currentDate = new Date(currentDate);
            if (currentDate >= start && currentDate <= end) 
            {
                return true;
            }
            else return false;
        }
    }
    
    function compareDates (currentDate, startDate, endDate)
    {
        var timestamp=Date.parse(currentDate);
        if (isNaN(timestamp)==false)
        {	
            //debugger;
            //currentDate.setHours(0,0,0,0);
            //startDate.setHours(0,0,0,0);
            //endDate.setHours(0,0,0,0);
            currentDate = new Date(currentDate);
            if (currentDate >= startDate && currentDate <= endDate) 
            {
                return true;
            }
            else 
                return false;
        }
        else
            return false;
    }
    function addDays(date, days) {
        var result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }
    
    Date.isLeapYear = function (year) { 
        return (((year % 4 === 0) && (year % 100 !== 0)) || (year % 401 === 0)); 
    };
    
    Date.getDaysInMonth = function (year, month) {
        return [31, (Date.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month];
    };
    
    Date.prototype.isLeapYear = function () { 
        return Date.isLeapYear(this.getFullYear()); 
    };
    
    Date.prototype.getDaysInMonth = function () { 
        return Date.getDaysInMonth(this.getFullYear(), this.getMonth());
    };
    Date.prototype.addMonths = function (value) {
        var n = this.getDate();
        this.setDate(1);
        this.setMonth(this.getMonth() + value);
        this.setDate(Math.min(n, this.getDaysInMonth()));
        return this;
    };
    
    function reformatDate(currDate)
    {
        //var newdate = ('0' + (currDate.getMonth()+1)).slice(-2) + '.' + ('0' + currDate.getDate()).slice(-2);
        var TBD = "TBD";
        var timestamp=Date.parse(currDate);
        var date = new Date(currDate);
        if (isNaN(timestamp)==false)
        {
            var newdate = date.getMonth()+1 + '.' + date.getDate();
            return newdate;
        }
        else
            return TBD;
    }

    function reformatDateNew(currDate)
    {
        //var newdate = ('0' + (currDate.getMonth()+1)).slice(-2) + '.' + ('0' + currDate.getDate()).slice(-2);
        var TBD = "TBD";
        var timestamp=Date.parse(currDate);
        if (isNaN(timestamp)==false)
        {
            var newdate = monthsArray[currDate.getMonth()] + ' ' + currDate.getDate();
            return newdate;
        }
        else
            return TBD;
    }

    function reformatDateHtml(currDate)
    {
        //var newdate = ('0' + (currDate.getMonth()+1)).slice(-2) + '.' + ('0' + currDate.getDate()).slice(-2);
        var TBD = "TBD";
        var timestamp=Date.parse(currDate);
        var date = new Date(currDate);
        if (isNaN(timestamp)==false)
        {
            var newdate = "<span class='date-month date-font'>" + monthsArray[date.getMonth()] + "</span><span class='date-day date-font-large'>" + date.getDate() + "</span>";
            return newdate;
        }
        else
            return TBD;
    }
    function getGTMMessage()
    {
        var url = "https://onesite.verizon.com/sites/HQ_GTM";
        var listname = "GTM Message";
        var today = new Date();
        var last7Days = new Date();
        last7Days = addDays(today, -7);
        last7Days = last7Days.format("yyyy-MM-ddT00:00:00Z");
        var query="?$filter=(Urgent_x0020_Date ge DateTime'" + last7Days + "' or Special_x0020_Meeting_x0020_Date ge DateTime'" + last7Days + "') &$select=ID,Special_x0020_Meeting_x0020_Date,Dark_x0020_Indicator,Special_x0020_Message,Urgent_x0020_Date,Urgent_x0020_Message_x0020_1,Urgent_x0020_Message_x0020_2";	
        var isAlert = false, isSpecial = false;
        $.ajax({
            async: false,
            url: url + "/_api/web/lists/getbytitle('" + listname + "')/items" + query,
            //CAMLViewFields: viewFields,
            method: "GET",
            async: false,
            headers: { "Accept": "application/json; odata=verbose" },
            success: function (data) {
                //complete(data); // Returns JSON collection of the results
                var stringData = JSON.stringify(data);
                var jsonObject = JSON.parse(stringData);
                var results = jsonObject.d.results;
                for(i = 0; i < results.length;i++)  {
                    // Get the start and end date/time of the event. FullCalendar will parse date strings in local time automagically, so we need to convert the UTC 
                    //date strings from SharePoint into local time. The formatDateToLocal() function above will take care of this. See comments in that function for more information.
                    var urgentDate=null, specialMeetingDate=null;
                    if (results[i].Urgent_x0020_Date != null)
                    {
                        urgentDate = moment.utc(results[i].Urgent_x0020_Date);
                    }
    
                    if (results[i].Special_x0020_Meeting_x0020_Date != null)
                    {
                        specialMeetingDate = moment.utc(results[i].Special_x0020_Meeting_x0020_Date);
                    }
                    if (urgentDate != null)	
                    {
                        if (compareDates(urgentDate,sunday,saturday))
                        {
                            darkIndicator = results[i].Dark_x0020_Indicator;
                            urgentMessage1 = results[i].Urgent_x0020_Message_x0020_1;
                            urgentMessage2 = results[i].Urgent_x0020_Message_x0020_2;
                            urgentMessages = urgentMessage1;
                            if (urgentMessage2 !=null)
                                urgentMessages = urgentMessages + "<br><span>" + urgentMessage2 + "</span>";
                            $("#alertmessage")[0].innerHTML = urgentMessages;
                            isAlert = true;
                        }
                    }
                    if (specialMeetingDate != null)	
                    {
                        if (compareDates(specialMeetingDate,sunday,saturday))
                        {
                            specialMessage = results[i].Special_x0020_Message;
                            $("#specialmessage")[0].innerHTML = specialMessage;
                            isSpecial = true;
                        }
                    }
                }
            },
            error: function (err) {
                //failure(data);
                alert ("SPGetListItems failed with error" + JSON.stringify(err));
            }
        });
        //===================================================
        /* for testing purposes - remove in production
        isSpecial = true;
        $("#specialmessage")[0].innerHTML = "Test Special Message - this is a very long message indeed";
        isAlert = true;
        $("#alertmessage")[0].innerHTML = "Special Alert Message";
        //======================================*/
        if (!isAlert)
            $("#alert").css({"display": "none"});
    
        if (!isSpecial)
            $("#specialmessage").css({"display": "none"});
    }
    
    function decodeImages()
    {
        //document.getElementById("meetingleft").src="https://esites.vzbi.com/sites/HQ_GTM/SiteAssets/Images/meetingleft.png";
        document.getElementById("meetingbanner").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/meetings-image-updated.jpg";
        //document.getElementById("happeningthisweek").src="https://esites.vzbi.com/sites/HQ_GTM/SiteAssets/Images/happeningthisweek.png"
        //document.getElementById("urgentimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/urgent.png";
        //document.getElementById("vcgimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/VCG.png";
        //document.getElementById("adminimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/admin20.png";
        //document.getElementById("archiveimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/archive20.png";
        //document.getElementById("feedbackimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/feedback20.png";
        //document.getElementById("vbgimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/VBG.png";
        //document.getElementById("leftarrowimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/leftarrow.png";
        //document.getElementById("rightarrowimg").src="https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/rightarrow.png";
        //document.getElementById("leftarrow2img").src="https://esites.vzbi.com/sites/HQ_GTM/SiteAssets/Images/leftarrow.png";
        //document.getElementById("rightarrow2img").src="https://esites.vzbi.com/sites/HQ_GTM/SiteAssets/Images/rightarrow.png";
        //document.getElementById("calendarupdatesimg").src="https://esites.vzbi.com/sites/HQ_GTM/SiteAssets/Images/calendarupdates.png";	
        //document.getElementById("startyourday").style.backgroundImage="url('https://onesite.verizon.com/sites/HQ_GTM/SiteAssets/Images/startyourday_s.png')";
    }
    
    function GetCurrentUsername()
    {
      userId = _spPageContextInfo.userId;
      var requestUri = _spPageContextInfo.webAbsoluteUrl + "/_api/web/getuserbyid(" + userId + ")";
      var requestHeaders = { "accept" : "application/json;odata=verbose" };
      $.ajax({
        url : requestUri,
        contentType : "application/json;odata=verbose",
        headers : requestHeaders,
        success : onSuccess,
        error : onError
      });
    }
    function onSuccess(data, request){
        sessionStorage.setItem("loginName", data.d.Title);
        localStorage.setItem("loginName", data.d.Title);
        names = data.d.Title.split(",");
        // select only the first section of name, for example, Lisa K. will just be Lisa	
        if (names.length > 1)
        {	
            names = names[1].trim().split(" ");
            $("#firstname")[0].innerHTML = names[0] + ",";
        }
        else
            $("#firstname")[0].innerHTML = names[0] + ",";
        }
    
    function onError(error) {
        alert("error");
    }
    /*  THIS DOES NOT WORK FOR IE
    function sortList(ul) {
      var ul = document.getElementById(ul);
    
      Array.from(ul.getElementsByTagName("li"))
        .sort((a, b) => a.textContent.localeCompare(b.textContent))
        .forEach(li => ul.appendChild(li));
    }*/
    function sortList(ul) {
    
        var elems = $('#extendedString li').detach().sort(function (a, b) {
          return ($(a).text() < $(b).text() ? -1 
                : $(a).text() > $(b).text() ? 1 : 0);
        }); 
        $('#extendedString').append(elems); 
    }
    
    function setArchiveURL()
    {
        var now = new Date();
        quarter = Math.floor((now.getMonth() / 3));
        firstDate = new Date(now.getFullYear(), quarter * 3, 1);
        var days = (now - firstDate) / (1000 * 60 * 60 * 24);
        //alert(Math.round(days));	
        if (days < 7)
        {
            quarter = quarter -1;
            firstDate = new Date(now.getFullYear(), quarter * 3, 1);
        }
        firstDate = firstDate.format("yyyy-MM-dd");
        var newURL = 'https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Calendar%20View-Archive.aspx?StartDate=' + firstDate;
        $("a[href='https://onesite.verizon.com/sites/HQ_GTM/SitePages/GTM%20Calendar%20View-Archive.aspx']").attr('href',newURL);
    }
    
    </script>
